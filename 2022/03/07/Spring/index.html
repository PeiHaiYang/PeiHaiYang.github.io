<!DOCTYPE html>


<html lang="en">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title> 红尘泪思颜</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-Spring"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
     
    <div class="article-meta">
      <a href="/2022/03/07/Spring/" class="article-date">
  <time datetime="2022-03-07T15:37:38.365Z" itemprop="datePublished">2022-03-07</time>
</a>   
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> Word count:</span>
            <span class="post-count">21.5k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> Reading time≈</span>
            <span class="post-count">98 min</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="Spring的优良特性："><a href="#Spring的优良特性：" class="headerlink" title="Spring的优良特性："></a>Spring的优良特性：</h2><pre><code>  ### Spring是一个IOC(DI)和AOP容器框架。
</code></pre>
<ol>
<li>1）        <strong>非侵入式：</strong>基于Spring开发的应用中的对象可以不依赖于Spring的API。</li>
<li>2）        <strong>控制反转：</strong>IOC——Inversion of Control，指的是将对象的创建权交给Spring去创建。使用Spring之前，对象的创建都是由我们自己在代码中new创建。而使用Spring之后。对象的创建都是由给了Spring框架。</li>
<li>3）        <strong>依赖注入：</strong>DI——Dependency Injection，是指依赖的对象不需要手动调用setXXX方法去设置，而是通过配置赋值。</li>
<li>4）        <strong>面向切面编程：</strong>AOP——Aspect Oriented Programming，在不修改源代码的基础上进行功能扩展。</li>
<li>5）        <strong>容器：Spring是一个容器</strong>，因为它包含并且管理应用对象的生命周期。</li>
<li>6）        <strong>组件化：</strong>Spring实现了使用简单的组件配置组合成一个复杂的应用。在 Spring 中可以使用XML和Java注解组合这些对象。</li>
<li>7）        <strong>一站式</strong>：在IOC和AOP的基础上可以整合各种企业应用的开源框架和优秀的第三方类库（实际上Spring 自身也提供了表述层的SpringMVC和持久层的JDBCTemplate）。</li>
</ol>
<h2 id="Spring模块图形以及介绍："><a href="#Spring模块图形以及介绍：" class="headerlink" title="Spring模块图形以及介绍："></a>Spring模块图形以及介绍：</h2><p><img src="/.%5Cimg%5Cspringmouldpic.png" alt="1611314611063"></p>
<h2 id="Spring框架分为五大模块："><a href="#Spring框架分为五大模块：" class="headerlink" title="Spring框架分为五大模块："></a>Spring框架分为五大模块：</h2><h4 id="Core-Container：核心容器"><a href="#Core-Container：核心容器" class="headerlink" title="Core Container：核心容器"></a>Core Container：核心容器</h4><h4 id="1、Beans-提供-BeanFactory，它是一个工厂模式的复杂实现。"><a href="#1、Beans-提供-BeanFactory，它是一个工厂模式的复杂实现。" class="headerlink" title="1、Beans  提供 BeanFactory，它是一个工厂模式的复杂实现。"></a>1、Beans  提供 BeanFactory，它是一个工厂模式的复杂实现。</h4><h4 id="2、Core提供了框架的基本组成部分，包括IOC和DI功能。"><a href="#2、Core提供了框架的基本组成部分，包括IOC和DI功能。" class="headerlink" title="2、Core提供了框架的基本组成部分，包括IOC和DI功能。"></a>2、Core提供了框架的基本组成部分，包括IOC和DI功能。</h4><h4 id="3、Context建立在由核心和-Bean-模块提供的基础上，它是访问定义和配置的任何对象的媒介。ApplicationContext-接口是上下文模块的重点。"><a href="#3、Context建立在由核心和-Bean-模块提供的基础上，它是访问定义和配置的任何对象的媒介。ApplicationContext-接口是上下文模块的重点。" class="headerlink" title="3、Context建立在由核心和 Bean 模块提供的基础上，它是访问定义和配置的任何对象的媒介。ApplicationContext 接口是上下文模块的重点。"></a>3、Context建立在由核心和 Bean 模块提供的基础上，它是访问定义和配置的任何对象的媒介。ApplicationContext 接口是上下文模块的重点。</h4><h4 id="4、SpEL在运行时提供了查询和操作一个对象的强大的Spring表达式语言。"><a href="#4、SpEL在运行时提供了查询和操作一个对象的强大的Spring表达式语言。" class="headerlink" title="4、SpEL在运行时提供了查询和操作一个对象的强大的Spring表达式语言。"></a>4、SpEL在运行时提供了查询和操作一个对象的强大的Spring表达式语言。</h4><h4 id="AOP-amp-Aspects：提供了面向切面编程的实现。"><a href="#AOP-amp-Aspects：提供了面向切面编程的实现。" class="headerlink" title="AOP&amp;Aspects：提供了面向切面编程的实现。"></a>AOP&amp;Aspects：提供了面向切面编程的实现。</h4><h4 id="DataAccess-x2F-Integration：提供了对数据访问-x2F-集成的功能。"><a href="#DataAccess-x2F-Integration：提供了对数据访问-x2F-集成的功能。" class="headerlink" title="DataAccess&#x2F;Integration：提供了对数据访问&#x2F;集成的功能。"></a>DataAccess&#x2F;Integration：提供了对数据访问&#x2F;集成的功能。</h4><h4 id="Web：提供了面向Web应用程序的集成功能。"><a href="#Web：提供了面向Web应用程序的集成功能。" class="headerlink" title="Web：提供了面向Web应用程序的集成功能。"></a>Web：提供了面向Web应用程序的集成功能。</h4><h4 id="Test：提供了对JUnit-或-TestNG-框架的测试功能。"><a href="#Test：提供了对JUnit-或-TestNG-框架的测试功能。" class="headerlink" title="Test：提供了对JUnit 或 TestNG 框架的测试功能。"></a>Test：提供了对JUnit 或 TestNG 框架的测试功能。</h4><blockquote>
<p>使用相应的模块必须引入相应的 jar 注意的是上层架构想要使用必须引入核心类库中的jar包 core依赖于jcl.jar </p>
</blockquote>
<h3 id="IOC和DI"><a href="#IOC和DI" class="headerlink" title="IOC和DI"></a>IOC和DI</h3><h4 id="1-5-1-IOC-Inversion-of-Control-：反转控制"><a href="#1-5-1-IOC-Inversion-of-Control-：反转控制" class="headerlink" title="1.5.1 IOC(Inversion of Control)：反转控制"></a>1.5.1 IOC(Inversion of Control)：反转控制</h4><p>​    在应用程序中的组件需要获取资源时，传统的方式是组件主动的从容器中获取所需要的资源，在这样的模式下开发人员往往需要知道在具体容器中特定资源的获取方式，增加了学习成本，同时降低了开发效率。</p>
<p>反转控制的思想完全颠覆了应用程序组件获取资源的传统方式：反转了资源的获取方向——改由容器主动的将资源推送给需要的组件，开发人员不需要知道容器是如何创建资源对象的，只需要提供接收资源的方式即可，极大的降低了学习成本，提高了开发的效率。这种行为也称为查找的被动形式。</p>
<h4 id="1-5-2-DI-Dependency-Injection-：依赖注入"><a href="#1-5-2-DI-Dependency-Injection-：依赖注入" class="headerlink" title="1.5.2 DI(Dependency Injection)：依赖注入"></a>1.5.2 DI(Dependency Injection)：依赖注入</h4><p>​      IOC的另一种表述方式：即组件以一些预先定义好的方式(例如：setter 方法)接受来自于容器的资源注入。相对于IOC而言，这种表述更直接。</p>
<p>​      总结: IOC 就是一种反转控制的思想， 而DI是对IOC的一种具体实现。</p>
<h4 id="1-5-3-IOC容器在Spring中的实现"><a href="#1-5-3-IOC容器在Spring中的实现" class="headerlink" title="1.5.3 IOC容器在Spring中的实现"></a>1.5.3 IOC容器在Spring中的实现</h4><p>​      在创建Bean之前，首先需要创建IOC容器。Spring提供了IOC容器的两种实现方式：</p>
<p>1） BeanFactory：IOC容器的基本实现，是Spring内部的使用接口，是面向Spring本身的，不是提供给开发人员使用的。</p>
<p>2）ApplicationContext：BeanFactory的子接口，提供了更多高级特性。面向Spring的使用者，几乎所有场合都使用ApplicationContext而不是底层的BeanFactory。</p>
<h2 id="Spring版的hello-World"><a href="#Spring版的hello-World" class="headerlink" title="Spring版的hello World"></a>Spring版的hello World</h2><h4 id="第一步要先进入jar包"><a href="#第一步要先进入jar包" class="headerlink" title="第一步要先进入jar包"></a>第一步要先进入jar包</h4><p><img src="/img%5Cjar.png" alt="1611316909757"></p>
<blockquote>
<p>expression是表达式 类似于EL表达式 ，core是核心包依赖于jc l包。Context是容器上下文对象，有访问容器的方法 beans提供了创建bean的方式，一个是普通的bean，一个是beanFactory 使用  beanFactory可以干预ioc容器创建bean对象 自定义要实现</p>
</blockquote>
<h4 id="第二步：创建Java类HelloWorld"><a href="#第二步：创建Java类HelloWorld" class="headerlink" title="第二步：创建Java类HelloWorld"></a>第二步：创建Java类HelloWorld</h4><ol>
<li>声明一个name属性</li>
<li>提供setName方法</li>
<li>创建sayHello方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HelloWorld</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello world: &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="第三步-在src目录下创建Spring-Config配置文件，并命名为applicationContext-xml"><a href="#第三步-在src目录下创建Spring-Config配置文件，并命名为applicationContext-xml" class="headerlink" title="第三步 在src目录下创建Spring Config配置文件，并命名为applicationContext.xml"></a>第三步 在src目录下创建Spring Config配置文件，并命名为applicationContext.xml</h4><p><img src="D:\笔记\spring\img\application.png" alt="application"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.HelloWorld&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tom&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="第四步：建立一个Test类进行测试："><a href="#第四步：建立一个Test类进行测试：" class="headerlink" title="第四步：建立一个Test类进行测试："></a>第四步：建立一个Test类进行测试：</h4><blockquote>
<p>创建ioc容器的方式：ApplicationContext 接口是上下文模块的重点。是Context这个jar提供的，提供了访问容器的方式  </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestHomeWork</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建ioc容器的方式：ApplicationContext 接口是上下文模块的重点。是Context这个jar提供的，提供了访问容器的方式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="keyword">private</span> <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">HelloWorld</span> <span class="variable">hello</span> <span class="operator">=</span> (HelloWorld) ioc.getBean(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        hello.sayHello();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ApplicationContext-有很多的实现类"><a href="#ApplicationContext-有很多的实现类" class="headerlink" title="ApplicationContext 有很多的实现类"></a>ApplicationContext 有很多的实现类</h4><p><img src="/img%5CApplicationContext%E5%AE%9E%E7%8E%B0%E7%B1%BB.png" alt="ApplicationContext实现类"></p>
<blockquote>
<p>1）        ClassPathXmlApplicationContext：对应类路径下的XML格式的配置文件（全类名）</p>
<p>2）        FileSystemXmlApplicationContext：对应文件系统中的XML格式的配置文件</p>
<p>3）        ConfigurableApplicationContext：是ApplicationContext的子接口，包含一些扩展方法refresh()和close()，让ApplicationContext具有启动、关闭和刷新上下文的能力。</p>
<p>4）        WebApplicationContext：专门为WEB应用而准备的，它允许从相对于WEB根目录的路径中完成初始化工作。</p>
</blockquote>
<h2 id="获取bean的三种方式："><a href="#获取bean的三种方式：" class="headerlink" title="获取bean的三种方式："></a>获取bean的三种方式：</h2><ol>
<li><h5 id="根据bean中的id"><a href="#根据bean中的id" class="headerlink" title="根据bean中的id"></a>根据bean中的id</h5></li>
<li><h5 id="根据bean的类型"><a href="#根据bean的类型" class="headerlink" title="根据bean的类型"></a>根据bean的类型</h5></li>
<li><h5 id="根据bean的id和类型"><a href="#根据bean的id和类型" class="headerlink" title="根据bean的id和类型"></a>根据bean的id和类型</h5></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取bean的三种方式；根据bean中的id 根据bean的类型 根据bean的id和类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="comment">//1、通过&lt;Bean id=&quot;&quot;&gt;bean中的id值来获取对象 返回的是object类型的对象</span></span><br><span class="line"> <span class="type">HelloWorld</span> <span class="variable">hello</span> <span class="operator">=</span> (HelloWorld) ioc.getBean(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line"><span class="comment">//2、通过&lt;Bean id =&quot;&quot;&gt;中的id值和对象的class 这种方式不用强制转换</span></span><br><span class="line"> <span class="type">HelloWorld</span> <span class="variable">hello1</span> <span class="operator">=</span> ioc.getBean(<span class="string">&quot;hello&quot;</span>, HelloWorld.class);</span><br><span class="line"><span class="comment">//3、根据bean的类型获取 如果在IOC容器中有多个该类型的bean则会抛出异常</span></span><br><span class="line">  <span class="type">HelloWorld</span> <span class="variable">bean</span> <span class="operator">=</span> ioc.getBean(HelloWorld.class);</span><br><span class="line">  bean.sayHello();</span><br><span class="line">  hello1.sayHello();</span><br><span class="line">  hello.sayHello();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="第二章基于XML的方式管理Bean"><a href="#第二章基于XML的方式管理Bean" class="headerlink" title="第二章基于XML的方式管理Bean"></a>第二章基于XML的方式管理Bean</h1><h2 id="创建Bean"><a href="#创建Bean" class="headerlink" title="创建Bean"></a>创建Bean</h2><p>让Spring的IOC容器帮我们创建Bean，只需要在Spring的配置文件中通过bean标签配置即可。</p>
<h3 id="bean标签中常用属性说明："><a href="#bean标签中常用属性说明：" class="headerlink" title="bean标签中常用属性说明："></a>bean标签中常用属性说明：</h3><p>1）        <strong>Id属性</strong>：给IOC容器中的bean设置的唯一标识。</p>
<p>2）       <strong>class属性</strong>：配置让IOC容器管理的类的全类名，Spring会利用反射技术通过类的无参构造器创建对象。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"> <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.Book&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">value</span>=<span class="string">&quot;一千零一夜&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">value</span>=<span class="string">&quot;peihaiyang&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;stock&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sales&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;hello&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.HelloWorld&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;tom&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="给Bean的属性赋值"><a href="#给Bean的属性赋值" class="headerlink" title="给Bean的属性赋值"></a>给Bean的属性赋值</h2><h4 id="setter注入"><a href="#setter注入" class="headerlink" title="setter注入 *"></a>setter注入 *</h4><p>​      在bean标签中通过property标签设置bean的属性值，property标签中的属性说明：</p>
<ul>
<li>l  <strong>name属性</strong>：配置bean的属性名</li>
<li>l  <strong>value属性</strong>：配置bean的属性值 </li>
<li>l  还可以通过value子标签配置bean的属性值</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set注入：</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--   基本的set注入 --&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;book&quot;</span> class=<span class="string">&quot;com.atguigu.bean.Book&quot;</span>&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;id&quot;</span> value=<span class="string">&quot;1001&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;title&quot;</span> value=<span class="string">&quot;一千零一夜&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;author&quot;</span> value=<span class="string">&quot;peihaiyang&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;price&quot;</span> value=<span class="string">&quot;1001&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;stock&quot;</span> value=<span class="string">&quot;1001&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=<span class="string">&quot;sales&quot;</span>&gt;&lt;value&gt;<span class="number">1001</span>&lt;/value&gt;&lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<h4 id="构造器注入"><a href="#构造器注入" class="headerlink" title="构造器注入"></a>构造器注入</h4><p> 在bean标签中通过constructor-arg标签设置bean的属性值，constructor-arg标签中的属性说明：</p>
<ul>
<li>l  name属性：配置构造器中的参数名</li>
<li>l  value属性：配置参数值</li>
<li>l  index属性：配置参数在构造器中的索引位置，从0开始</li>
<li>l  type属性：配置构造器中参数的类型</li>
<li>注意：</li>
</ul>
<p>构造器原型；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">Book</span><span class="params">(Integer id, String title, String author, Double price, Integer stock, Integer sales)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">    <span class="built_in">this</span>.title = title;</span><br><span class="line">    <span class="built_in">this</span>.author = author;</span><br><span class="line">    <span class="built_in">this</span>.price = price;</span><br><span class="line">    <span class="built_in">this</span>.stock = stock;</span><br><span class="line">    <span class="built_in">this</span>.sales = sales;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="构造器默认用value属性：配置参数值"><a href="#构造器默认用value属性：配置参数值" class="headerlink" title="构造器默认用value属性：配置参数值"></a>构造器默认用value属性：配置参数值</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    构造器注入之 默认 他是按照构造器属性的顺序进行注入的 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.Book&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;1002&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;解忧杂货店&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;吉野&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;1002&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;1002&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="构造器使用index-索引位置进行属性值的注入-index从0开始"><a href="#构造器使用index-索引位置进行属性值的注入-index从0开始" class="headerlink" title="构造器使用index 索引位置进行属性值的注入 index从0开始"></a>构造器使用index 索引位置进行属性值的注入 index从0开始</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--  构造器注入之 index索引 指定对应的索引位置 一一对应构造器中的属性 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.Book&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;1002&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;解忧杂货店&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;吉野&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;5&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">index</span>=<span class="string">&quot;4&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1002&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="构造器使用name-指定属性的name-进行属性值的注入"><a href="#构造器使用name-指定属性的name-进行属性值的注入" class="headerlink" title="构造器使用name 指定属性的name 进行属性值的注入"></a>构造器使用name 指定属性的name 进行属性值的注入</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--  构造器注入之 name属性名 指定对应的属性名 一一对应构造器中的属性 --&gt;</span><br><span class="line">&lt;bean id=&quot;book3&quot; class=&quot;com.atguigu.bean.Book&quot;&gt;</span><br><span class="line">    &lt;constructor-arg value=&quot;1002&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">    &lt;constructor-arg value=&quot;解忧杂货店&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">    &lt;constructor-arg value=&quot;吉野&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">    &lt;constructor-arg value=&quot;100&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">    &lt;constructor-arg name=&quot;sales&quot; value=&quot;100&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">    &lt;constructor-arg name=&quot;stock&quot; value=&quot;1002&quot;&gt;&lt;/constructor-arg&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<h5 id="构造器使用type-指定属性的类型-进行属性值的注入"><a href="#构造器使用type-指定属性的类型-进行属性值的注入" class="headerlink" title="构造器使用type   指定属性的类型 进行属性值的注入"></a>构造器使用type   指定属性的类型 进行属性值的注入</h5><p>这种方式一定要注意一点，因为很容易犯错的</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  构造器注入之type类型 先找匹配指定type类型的对应的属性名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book4&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.Book&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;1002&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;解忧杂货店&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;吉野&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.Double&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;100000&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="特殊值处理"><a href="#特殊值处理" class="headerlink" title="特殊值处理"></a>特殊值处理</h4><p>1、字面量</p>
<pre><code>   字面量是用于表达源代码中一个固定值的表示法。基本数据类型及其包装类型、String等类型都可以采取字面值注入的方式。
</code></pre>
<p>2、 赋null值</p>
<p>​       通过<null></null>标签给bean的属性赋null值</p>
<p>3、赋值中包含特殊字符</p>
<p>​      若字面值中包含特殊字符，可以使用<![CDATA[   ]]>把字面值包裹起来</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    特殊值处理 &lt;![CDATA[   ]]&gt; --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;book5&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.Book&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;1002&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> &gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">value</span>&gt;</span>&lt;![CDATA[&lt;&lt;解忧杂货店&gt;&gt;]]&gt;<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;吉野&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">type</span>=<span class="string">&quot;java.lang.Double&quot;</span>  <span class="attr">value</span>=<span class="string">&quot;100000&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="使用p命名空间"><a href="#使用p命名空间" class="headerlink" title="使用p命名空间"></a>使用p命名空间</h4><p><img src="/img%5Cp%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9A%84%E5%AF%BC%E5%85%A5.png" alt="p命名空间的导入"></p>
<p>使用p名称空间需要引入对应的约束，在Idea中根据提示引入即可。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;book6&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.Book&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:id</span>=<span class="string">&quot;1006&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:title</span>=<span class="string">&quot;解忧&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:author</span>=<span class="string">&quot;吉野&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:price</span>=<span class="string">&quot;1001&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:stock</span>=<span class="string">&quot;1002&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">p:sales</span>=<span class="string">&quot;1003&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="引用外部已声明的bean"><a href="#引用外部已声明的bean" class="headerlink" title="引用外部已声明的bean *"></a>引用外部已声明的bean *</h3><p>​          当bean的属性是一个其他类型的对象是，可以在property或<constructor-arg>标签中通过ref属性或ref子标签引用IOC容器中配置好的该类型的bean，ref的属性值指定为引用的bean的id值。</p>
<p><strong>使用ref 引入对应的id值即可</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    引入外部类的方式--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cartItem&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.CartItem&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;book&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;book&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;amount&quot;</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="内部bean"><a href="#内部bean" class="headerlink" title="内部bean"></a>内部bean</h3><p>​      当bean实例仅仅给一个特定的属性使用时，可以将其声明为内部bean。内部bean声明直接包含在<property>或<constructor-arg>元素里，不需要设置id。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    内部的bean --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cartItem1&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.CartItem&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;book&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.Book&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;id&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;title&quot;</span> <span class="attr">value</span>=<span class="string">&quot;一千零一夜&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;author&quot;</span> <span class="attr">value</span>=<span class="string">&quot;peihaiyang&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;price&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;stock&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sales&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1001&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;amount&quot;</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="级联属性赋值"><a href="#级联属性赋值" class="headerlink" title="级联属性赋值"></a>级联属性赋值</h3><p>​            当bean的属性是一个对象，我们可以通过配置当前bean的方式给属性中对象的属性赋值，即给属性的属性赋值，这种方式我们称为给级联属性赋值。</p>
<p><img src="/img%5C%E7%BA%A7%E8%81%94%E5%B1%9E%E6%80%A7.png" alt="级联属性"></p>
<p>在CartItem中有Book 属性 Book属性中还有title属性，现在我想通过CartItem来修改Book中的book.title属性；</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cartItem2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.CartItem&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;book&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;book&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;book.title&quot;</span> <span class="attr">value</span>=<span class="string">&quot;day day up&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;amount&quot;</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="集合属性"><a href="#集合属性" class="headerlink" title="集合属性"></a>集合属性</h3><p>当bean的属性是集合类型时，可以通过以下标签进行配置：</p>
<ul>
<li><array></array>：配置数组类型</li>
<li><list></list>：配置List类型</li>
<li>&lt;map&gt;&lt;entry&gt;&lt;&#x2F;entry&gt;&lt;&#x2F;map&gt;：配置Map类型</li>
<li><props><prop key="配置key">配置value</prop></props>：配置Properties类型</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    测试集合的bean注入  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;list&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.TestCollection&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;drive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;integers&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;props&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;url&quot;</span>&gt;</span>jdbc:mysql://localhost:3306/<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="集合类型的bean"><a href="#集合类型的bean" class="headerlink" title="集合类型的bean"></a>集合类型的bean</h4><p>​        如果只能将集合对象配置在某个bean内部，则这个集合的配置将不能被重用。我们需要将集合bean的配置拿到外面，供其他bean引用。</p>
<p>​      配置集合类型的bean需要引入util名称空间。</p>
<p><img src="D:\笔记\spring\img\util使用的命名空间.png" alt="util使用的命名空间"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;list2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;list3&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.TestCollection&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;list2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;drive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;integers&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>2<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>3<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">value</span>&gt;</span>4<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;props&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">props</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">prop</span> <span class="attr">key</span>=<span class="string">&quot;url&quot;</span>&gt;</span>jdbc:mysql://localhost:3306/<span class="tag">&lt;/<span class="name">prop</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">props</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">util:list</span> <span class="attr">id</span>=<span class="string">&quot;list2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">value</span>&gt;</span>1<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:list</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="自动装配-autowire"><a href="#自动装配-autowire" class="headerlink" title="自动装配 autowire"></a>自动装配 autowire</h3><p><strong>手动装配</strong>：以value或ref的方式明确指定属性值都是手动装配。</p>
<p><strong>自动装配</strong>：根据bean标签的autowire属性指定的装配规则，不需要明确指定，Spring自动将匹配的属性值注入bean中。</p>
<p>自动装配的规则，即<strong>autowire</strong>的属性值有：</p>
<ul>
<li>l  no或default：不自动装配</li>
<li>l  byName：根据bean的属性名称自动装配，以当前bean的属性名作为<strong>id</strong>从IOC容器中寻找以实现装配。<strong>找到则装配，找不到则不装配。</strong></li>
<li>l  byType：根据<strong>bean的属性</strong>类型自动装配。<strong>找到一个则装配，找到多个则报错，找不到则不装配</strong>。</li>
<li>l  constructor：根据bean的属性的构造器自动装配，不推荐使用。</li>
</ul>
<h4 id="byName"><a href="#byName" class="headerlink" title="byName"></a>byName</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cartItem4&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.CartItem&quot;</span> <span class="attr">autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;count&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;amount&quot;</span> <span class="attr">value</span>=<span class="string">&quot;200&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="byType"><a href="#byType" class="headerlink" title="byType"></a>byType</h4><p><img src="/img%5Cautowair.png" alt="autowair"></p>
<h3 id="引入外部属性文件"><a href="#引入外部属性文件" class="headerlink" title="引入外部属性文件"></a>引入外部属性文件</h3><p>​    当bean的配置信息逐渐增多时，查找和修改一些bean的配置信息就变得愈加困难。这时可以将一部分信息提取到bean配置文件的外部，以properties格式的属性文件保存起来，同时在bean的配置文件中引用properties属性文件中的内容，从而实现一部分属性值在发生变化时仅修改properties属性文件即可。这种技术多用于连接数据库的基本信息的配置。</p>
<ol>
<li><pre><code>导入druid-1.1.9.jar和mysql-connector-java-5.1.37-bin.jar
</code></pre>
</li>
<li><pre><code>在src目录下创建外部属性文件druid.properties
</code></pre>
</li>
</ol>
<p><img src="/img%5C%E5%BC%95%E5%85%A5%E5%A4%96%E9%83%A8%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6.png" alt="引入外部的配置文件"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">       https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:druid.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.initialSize&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxActive&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>properties中的文件：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#key=value</span></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/test</span></span><br><span class="line"><span class="attr">jdbc.driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jdbc.initialSize</span>=<span class="string">5</span></span><br><span class="line"><span class="attr">jdbc.maxActive</span>=<span class="string">10</span></span><br></pre></td></tr></table></figure>



<h3 id="FactoryBean"><a href="#FactoryBean" class="headerlink" title="FactoryBean"></a>FactoryBean</h3><p>Spring中有两种类型的bean，一种是普通bean，另一种是工厂bean，即FactoryBean。普通bean设置的类型就是返回的类型；工厂bean设置的类型可以和返回的类型不一样，其返回的类型通过该工厂bean的getObject方法指定。</p>
<p>​      创建工厂bean必须实现org.springframework.beans.factory.FactoryBean接口。</p>
<p>创建工厂bean的步骤：</p>
<ol>
<li><pre><code>创建一个类实现FactoryBean接口
</code></pre>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Book&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Book</span>(<span class="number">1001</span>,<span class="string">&quot;book&quot;</span>,<span class="string">&quot;phy&quot;</span>,<span class="number">12.0</span>,<span class="number">100</span>,<span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注册bean</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;factory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.bean.MyFactoryBean&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">     <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">     <span class="type">Book</span> <span class="variable">factory</span> <span class="operator">=</span> (Book) ioc.getBean(<span class="string">&quot;factory&quot;</span>);</span><br><span class="line">     System.out.println(<span class="string">&quot;factory = &quot;</span> + factory);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Spring中的-Bean-的作用域"><a href="#Spring中的-Bean-的作用域" class="headerlink" title="Spring中的 Bean 的作用域"></a>Spring中的 <strong>Bean</strong> 的作用域</h3><p>​      在Spring中，可以在bean标签的scope属性里设置bean的作用域，以决定这个bean是单实例的还是多实例的。</p>
<p>​      默认情况下，Spring只为每个在<strong>IOC容器里</strong>声明的bean创建<strong>唯一一个实例</strong>，整个IOC容器范围内都能共享该实例：所有<strong>后续的getBean()调用</strong>和<strong>bean引用</strong>都将返回这个唯一的bean实例。该作用域被称为singleton，它是所有bean的默认作用域。</p>
<p>​      当bean的作用域为单例时，Spring会在IOC容器对象创建时就创建bean的对象实例。而当bean的作用域为prototype时，IOC容器在获取bean的实例时创建bean的实例对象，而且每调用一次getBean()就创建一个实例。</p>
<table>
<thead>
<tr>
<th>类别</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>singleton</td>
<td>在Spring的IOC容器中仅存在一个Bean实例</td>
</tr>
<tr>
<td>prototype</td>
<td>每次调用getBean方法都返回一个新的Bean实例</td>
</tr>
<tr>
<td>request</td>
<td>每次HTTP请求都会创建一个新的Bean实例，该作用域仅适用于WebApplicationContext环境</td>
</tr>
<tr>
<td>session</td>
<td>同一个Session会话共享一个Bean实例，该作用域仅适用于WebApplicationContext环境</td>
</tr>
</tbody></table>
<h1 id="Spring-中的Bean的生命周期"><a href="#Spring-中的Bean的生命周期" class="headerlink" title="Spring 中的Bean的生命周期"></a>Spring 中的Bean的生命周期</h1><p>​      Spring IOC容器可以管理bean的生命周期，Spring允许在bean生命周期内特定的时间点执行指定的任务。</p>
<h2 id="1-Spring-IOC容器对bean的生命周期进行管理的过程："><a href="#1-Spring-IOC容器对bean的生命周期进行管理的过程：" class="headerlink" title="1)     Spring IOC容器对bean的生命周期进行管理的过程："></a>1)     Spring IOC容器对bean的生命周期进行管理的过程：</h2><ol>
<li>通过构造器或工厂方法创建bean实例</li>
</ol>
<p>   ​    调用bean中的空参构造器</p>
<ol start="2">
<li>为bean的属性设置值和对其他bean的引用</li>
</ol>
<p>   ​    调用set 方法进行属性的赋值操作</p>
<ol start="3">
<li>bean可以使用了</li>
</ol>
<p>   ​    然后找个bean可以使用了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.spring.beans;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanLife</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//第一步</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BeanLife</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BeanLife对象被创建&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//第二步</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BeanLife的name属性被赋值&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BeanLife&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-在配置bean时，可以通过init-method和destroy-method-属性为bean指定初始化和销毁的方法"><a href="#2-在配置bean时，可以通过init-method和destroy-method-属性为bean指定初始化和销毁的方法" class="headerlink" title="2)     在配置bean时，可以通过init-method和destroy-method 属性为bean指定初始化和销毁的方法"></a>2)     在配置bean时，可以通过init-method和destroy-method 属性为bean指定初始化和销毁的方法</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.spring.beans;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanLife</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">	<span class="comment">//第一步执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BeanLife</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BeanLife对象被创建&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//第二步执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;BeanLife的name属性被赋值&quot;</span>);</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//在对象调用之前执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initMethod</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化的方法&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">	<span class="comment">//在ioc容器被销毁之后执行</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destoryMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;销毁的方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;BeanLife&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="在Spring的配置文件中配置初始化和销毁的方法"><a href="#在Spring的配置文件中配置初始化和销毁的方法" class="headerlink" title="在Spring的配置文件中配置初始化和销毁的方法"></a>在Spring的配置文件中配置初始化和销毁的方法</h5></li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`*<span class="comment">&lt;!--Bean**的生命周期**--&gt;</span>*   &lt;**bean** **id****=&quot;beanLife&quot;** **class****=&quot;com.atguigu.spring.beans.BeanLife&quot;** **init-method****=&quot;initMethod&quot;** **destroy-method****=&quot;destoryMethod&quot;**&gt;     &lt;**property** **name****=&quot;name&quot;** **value****=&quot;****测试****Bean****的生命周期****&quot;**&gt;&lt;/**property**&gt;   &lt;/**bean**&gt;`       </span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="在测试类中测试"><a href="#在测试类中测试" class="headerlink" title="在测试类中测试"></a>在测试类中测试</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">   测试Bean的生命周期</span></span><br><span class="line"><span class="comment">   在ApplicationContext下有ConfigurableApplicationContext接口</span></span><br><span class="line"><span class="comment">   这个接口定义了ioc容器reflush刷新和close关闭功能接口</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testBeanLife</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">BeanLife</span> <span class="variable">beanLife</span> <span class="operator">=</span> (BeanLife) ioc.getBean(<span class="string">&quot;beanLife&quot;</span>);</span><br><span class="line">    System.out.println(beanLife+<span class="string">&quot;对象可以使用了&quot;</span>);</span><br><span class="line">    <span class="comment">//关闭容器</span></span><br><span class="line"> </span><br><span class="line">    <span class="type">ConfigurableApplicationContext</span> <span class="variable">coc</span> <span class="operator">=</span> (ConfigurableApplicationContext)ioc;</span><br><span class="line">    coc.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="配置了这两个方法之后的生命周期过程："><a href="#配置了这两个方法之后的生命周期过程：" class="headerlink" title="配置了这两个方法之后的生命周期过程："></a>配置了这两个方法之后的生命周期过程：</h5></li>
</ul>
<ol>
<li>通过构造器或工厂方法创建bean实例</li>
<li>为bean的属性设置值和对其他bean的引用</li>
<li>调用bean的初始化方法</li>
<li>bean可以使用了</li>
<li>当容器关闭时，调用bean的销毁方法</li>
</ol>
<h2 id="3-bean的后置处理器"><a href="#3-bean的后置处理器" class="headerlink" title="3 )     bean的后置处理器"></a>3 )     bean的后置处理器</h2><ul>
<li><h5 id="l-bean后置处理器允许在调用初始化方法前后对bean进行额外的处理。"><a href="#l-bean后置处理器允许在调用初始化方法前后对bean进行额外的处理。" class="headerlink" title="l  bean后置处理器允许在调用初始化方法前后对bean进行额外的处理。"></a>l  bean后置处理器允许在调用初始化方法前后对bean进行额外的处理。</h5></li>
<li><h5 id="l-bean后置处理器对IOC容器里的所有bean实例逐一处理，而非单一实例，其典型应用是：检查bean属性的正确性或根据特定的标准更改bean的属性。"><a href="#l-bean后置处理器对IOC容器里的所有bean实例逐一处理，而非单一实例，其典型应用是：检查bean属性的正确性或根据特定的标准更改bean的属性。" class="headerlink" title="l  bean后置处理器对IOC容器里的所有bean实例逐一处理，而非单一实例，其典型应用是：检查bean属性的正确性或根据特定的标准更改bean的属性。"></a>l  bean后置处理器对IOC容器里的所有bean实例逐一处理，而非单一实例，其典型应用是：检查bean属性的正确性或根据特定的标准更改bean的属性。</h5></li>
<li><h5 id="l-bean后置处理器需要实现接口："><a href="#l-bean后置处理器需要实现接口：" class="headerlink" title="l  bean后置处理器需要实现接口："></a>l  bean后置处理器需要实现接口：</h5><h5 id="org-springframework-beans-factory-config-BeanPostProcessor。在初始化方法被调用前后，Spring将把每个bean实例分别传递给上述接口的以下两个方法："><a href="#org-springframework-beans-factory-config-BeanPostProcessor。在初始化方法被调用前后，Spring将把每个bean实例分别传递给上述接口的以下两个方法：" class="headerlink" title="org.springframework.beans.factory.config.BeanPostProcessor。在初始化方法被调用前后，Spring将把每个bean实例分别传递给上述接口的以下两个方法："></a>org.springframework.beans.factory.config.BeanPostProcessor。在初始化方法被调用前后，Spring将把每个bean实例分别传递给上述接口的以下两个方法：</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">postProcessBeforeInitialization(Object, String)</span><br><span class="line"></span><br><span class="line">postProcessAfterInitialization(Object, String)</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="l-创建Bean的后置处理器"><a href="#l-创建Bean的后置处理器" class="headerlink" title="l  创建Bean的后置处理器"></a>l  创建Bean的后置处理器</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.spring.beans;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">       bean：传入的bean对象</span></span><br><span class="line"><span class="comment">       beanName：bean的名称，即IOC容器中配置的bean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化方法之前执行&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化方法之后执行&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="l-在Spring的配置文件中配置Bean的后置处理器"><a href="#l-在Spring的配置文件中配置Bean的后置处理器" class="headerlink" title="l  在Spring的配置文件中配置Bean的后置处理器"></a>l  在Spring的配置文件中配置Bean的后置处理器</h5></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--配置Bean的后置处理器--&gt;</span><br><span class="line">&lt;bean id=<span class="string">&quot;myBeanPostProcessor&quot;</span> class=<span class="string">&quot;com.atguigu.spring.beans.MyBeanPostProcessor&quot;</span>&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><h5 id="l-配置了后置处理器之后的生命周期过程：-最全的一个bean的生命周期"><a href="#l-配置了后置处理器之后的生命周期过程：-最全的一个bean的生命周期" class="headerlink" title="l  配置了后置处理器之后的生命周期过程：(最全的一个bean的生命周期)"></a>l  配置了后置处理器之后的生命周期过程：(最全的一个bean的生命周期)</h5></li>
</ul>
<ol>
<li>通过构造器或工厂方法创建bean实例</li>
<li>为bean的属性设置值和对其他bean的引用</li>
<li>将bean实例传递给bean后置处理器的postProcessBeforeInitialization()方法</li>
<li>调用bean的初始化方法</li>
<li>将bean实例传递给bean后置处理器的postProcessAfterInitialization()方法</li>
<li>bean可以使用了</li>
<li>当容器关闭时调用bean的销毁方法</li>
</ol>
<h1 id="第3章-基于注解的方式管理Bean"><a href="#第3章-基于注解的方式管理Bean" class="headerlink" title="第3章 基于注解的方式管理Bean"></a>第3章 基于注解的方式管理Bean</h1><h2 id="创建Bean-1"><a href="#创建Bean-1" class="headerlink" title="创建Bean"></a>创建Bean</h2><h4 id="使用注解标识组件"><a href="#使用注解标识组件" class="headerlink" title="使用注解标识组件"></a>使用注解标识组件</h4><h4 id="1-Component（最基础的注解）"><a href="#1-Component（最基础的注解）" class="headerlink" title="1)     @Component（最基础的注解）"></a>1)     @Component（最基础的注解）</h4><p><strong>组件化可以让spring帮我们创建对象。不用在application.xml中配置bean了，其他的三个注解其实本质上都是component注解，其实只是给程序员来区分的，程序上是没有影响的</strong></p>
<p>标识一个受Spring IOC容器管理的组件</p>
<h4 id="2-Repository"><a href="#2-Repository" class="headerlink" title="2)     @Repository"></a>2)     @Repository</h4><p>标识一个受Spring IOC容器管理的持久化层组件</p>
<h4 id="3-Service"><a href="#3-Service" class="headerlink" title="3)     @Service"></a>3)     @Service</h4><p>标识一个受Spring IOC容器管理的业务逻辑层组件</p>
<h4 id="4-Controller"><a href="#4-Controller" class="headerlink" title="4)     @Controller"></a>4)     @Controller</h4><p>标识一个受Spring IOC容器管理的表述层控制器组件</p>
<h4 id="5-组件命名规则"><a href="#5-组件命名规则" class="headerlink" title="5)     组件命名规则"></a>5)     组件命名规则</h4><p>a)     默认情况：使用组件的简单类名首字母小写后得到的字符串作为bean的id</p>
<p>b)     我们可以使用组件注解的value属性指定bean的id，value属性名可以省略 </p>
<p><img src="/img%5C%E5%9B%9B%E5%A4%A7%E6%B3%A8%E8%A7%A3%E4%BD%BF%E7%94%A8.png" alt="四大注解使用">                  </p>
<blockquote>
<p><strong>注意：</strong>事实上Spring并没有能力识别一个组件到底是不是它所标记的类型，即使将      @Respository注解用在一个业务逻辑层组件上面也不会产生任何错误，所以@Respository、@Service、@Controller这几个注解仅仅是为了让开发人员自己明确当前的组件扮演的角色。</p>
</blockquote>
<h2 id="组件扫描"><a href="#组件扫描" class="headerlink" title="组件扫描"></a>组件扫描</h2><p><strong><code>当想使用注解进行开发时，要注意在配置文件中要进行注解的包扫描，否则spring将不能自动的创建对象；</code></strong></p>
<h3 id="使用包扫描的规则："><a href="#使用包扫描的规则：" class="headerlink" title="使用包扫描的规则："></a>使用包扫描的规则：</h3><p><strong>通过注解的方式管理Bean还需要在原有jar包的基础上导入spring-aop-5.3.1.jar</strong></p>
<p>组件被上述注解标识后还需要通过Spring进行扫描才能够侦测到。</p>
<h3 id="1、指定要扫描的包"><a href="#1、指定要扫描的包" class="headerlink" title="1、指定要扫描的包"></a>1、指定要扫描的包</h3><h4 id="lt-context-component-scan-base-package-x3D-”com-atguigu”-resource-pattern-x3D-”com-x2F-atguigu-x2F-dao-x2F-class”-gt-lt-x2F-context-component-scan-gt"><a href="#lt-context-component-scan-base-package-x3D-”com-atguigu”-resource-pattern-x3D-”com-x2F-atguigu-x2F-dao-x2F-class”-gt-lt-x2F-context-component-scan-gt" class="headerlink" title="&lt;context:component-scan base-package&#x3D;”com.atguigu” resource-pattern&#x3D;”com&#x2F;atguigu&#x2F;dao&#x2F;*.class”&gt;&lt;&#x2F;context:component-scan&gt;"></a>&lt;context:component-scan base-package&#x3D;”com.atguigu” resource-pattern&#x3D;”com&#x2F;atguigu&#x2F;dao&#x2F;*.class”&gt;&lt;&#x2F;context:component-scan&gt;</h4><p>使用context标签必须引入对应的类名空间&lt;context:component-scan </p>
<p><strong>base-package</strong>是要扫描的包这里使用全路径，是全部的包下类，全都扫描。</p>
<p>也可以精确的查找 ：</p>
<ul>
<li>精确的查找可以分为三种，一个属性，二个标签<ul>
<li>resource -pattern：属性，使用的是&#x2F; (不是 .  )</li>
<li>&lt;context:include-filter：使用包含过滤器</li>
<li>&lt;context:exclude-filter：使用排除过滤器</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag"><span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span><span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu&quot;</span> <span class="attr">resource-pattern</span>=<span class="string">&quot;com/atguigu/dao/*.class&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="包扫描的属性说明："><a href="#包扫描的属性说明：" class="headerlink" title="包扫描的属性说明："></a>包扫描的属性说明：</h4><ol>
<li>base-package属性指定一个需要扫描的基类包，Spring容器将会扫描这个基类包及其子包中的所有类。</li>
<li>当需要扫描多个包时可以使用逗号分隔。</li>
<li>如果仅希望扫描特定的类而非基包下的所有类，可使用resource-pattern属性过滤特定的类。</li>
</ol>
<h3 id="包扫描之二：精准查找"><a href="#包扫描之二：精准查找" class="headerlink" title="包扫描之二：精准查找"></a>包扫描之二：精准查找</h3><h4 id="lt-context-include-filter-为XX包-含在扫描范围之内的。"><a href="#lt-context-include-filter-为XX包-含在扫描范围之内的。" class="headerlink" title="&lt;context:include-filter 为XX包 含在扫描范围之内的。"></a><strong>&lt;context:include-filter</strong> 为XX包 含在扫描范围之内的。</h4><blockquote>
<p>精准的扫描包，<strong>type&#x3D;”annotation”</strong> 和  <strong>type&#x3D;”assignable”</strong> 是精准扫描<br><strong>use-default-filters&#x3D;”false”</strong> 是默认扫描方式，默认为<strong>true</strong>即：扫描所有的子        包；当使用 include 时要改为false；</p>
</blockquote>
<pre><code>  #####  当 type=&quot;annotation&quot;  expression的值为注解的的全路径名  
</code></pre>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line"> 		<span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Service&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="当type值是assignable这个时，expression的值为接口或类的全路径名"><a href="#当type值是assignable这个时，expression的值为接口或类的全路径名" class="headerlink" title="当type值是assignable这个时，expression的值为接口或类的全路径名"></a>当type值是assignable这个时，expression的值为接口或类的全路径名</h5>  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;assignable&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;com.atguigu.service.UserService&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="lt-context-exclude-filter-为在XX包-中的不在扫描范围"><a href="#lt-context-exclude-filter-为在XX包-中的不在扫描范围" class="headerlink" title="&lt;context:exclude-filter 为在XX包 中的不在扫描范围"></a>&lt;context:exclude-filter 为在XX包 中的不在扫描范围</h4><blockquote>
<p>注意不能在type&#x3D;”assignable”时，expression的值为注解org.springframework.stereotype.component 这个基础的注解，这样所有的注解都不好使了；</p>
</blockquote>
<h5 id="当type-x3D-”annotation”-expression的值为注解的全类名"><a href="#当type-x3D-”annotation”-expression的值为注解的全类名" class="headerlink" title="当type&#x3D;”annotation” expression的值为注解的全类名"></a>当type&#x3D;”annotation” expression的值为注解的全类名</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Service&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="当type-x3D-”assignable”-这个时。expression-的值为接口或者类的全类名"><a href="#当type-x3D-”assignable”-这个时。expression-的值为接口或者类的全类名" class="headerlink" title="当type&#x3D;”assignable” 这个时。expression 的值为接口或者类的全类名"></a>当type&#x3D;”assignable” 这个时。expression 的值为接口或者类的全类名</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span>  <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;assignable&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;com.atguigu.service.UserService&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="type属性值说明："><a href="#type属性值说明：" class="headerlink" title="type属性值说明："></a>type属性值说明：</h4><table>
<thead>
<tr>
<th>类别</th>
<th>示例</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td>annotation</td>
<td>com.atguigu.XxxAnnotation</td>
<td align="left">过滤所有标注了XxxAnnotation的类。这个规则根据目标组件是否标注了指定类型的注解进行过滤。</td>
</tr>
<tr>
<td>assignable</td>
<td>com.atguigu.BaseXxx</td>
<td align="left">过滤所有BaseXxx类的子类。这个规则根据目标组件是否是指定类型的子类的方式进行过滤。</td>
</tr>
<tr>
<td>aspectj</td>
<td>com.atguigu.*Service+</td>
<td align="left">所有类名是以Service结束的，或这样的类的子类。这个规则根据AspectJ表达式进行过滤。</td>
</tr>
<tr>
<td>regex</td>
<td>com.atguigu.anno.*</td>
<td align="left">所有com.atguigu.anno包下的类。这个规则根据正则表达式匹配到的类名进行过滤。</td>
</tr>
<tr>
<td>custom</td>
<td>com.atguigu.XxxTypeFilter</td>
<td align="left">使用XxxTypeFilter类通过编码的方式自定义过滤规则。该类必须实现org.springframework.core.type.filter.TypeFilter接口</td>
</tr>
</tbody></table>
<blockquote>
<p> <strong>component-scan下可以拥有若干个 include-filter和  exclude-filter子标签</strong></p>
</blockquote>
<h3 id="给Bean的属性注入值——自动装配"><a href="#给Bean的属性注入值——自动装配" class="headerlink" title="给Bean的属性注入值——自动装配"></a>给Bean的属性注入值——自动装配</h3><p>Controller组件中往往需要用到Service组件的实例，Service组件中往往需要用到Repository组件的实例。Spring可以通过注解的方式帮我们实现属性的装配。</p>
<p>​      在指定要扫描的包时，<a href="context:component-scan">context:component-scan</a> 元素会自动注册一个bean的后置处理器：AutowiredAnnotationBeanPostProcessor的实例。该后置处理器可以自动装配标记了@Autowired、@Resource或@Inject注解的属性。</p>
<ol>
<li><pre><code>@Autowired注解
</code></pre>
</li>
</ol>
<ul>
<li>构造器、普通字段(即使是非public)、一切具有参数的方法都可以应用@Autowired注解。</li>
<li>默认情况下，所有使用@Autowired注解的属性都需要被设置。当Spring找不到匹配的bean装配属性时，会抛出异常。</li>
<li>若某一属性允许不被设置，可以设置@Autowired注解的<strong>required</strong>属性为 false。如果是在默认的情况下，@Autowired是必须注入成功的，否则会报错。</li>
<li>@Autowired注解也可以应用在数组类型的属性上，此时Spring将会把所有匹配的bean进行自动装配。</li>
<li>@Autowired注解也可以应用在集合属性上，此时Spring读取该集合的类型信息，然后自动装配所有与之兼容的bean。</li>
<li>@Autowired注解用在java.util.Map上时，若该Map的键值为String，那么 Spring将自动装配与值类型兼容的bean作为值，并以bean的id值作为键。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当不是必须要spring注入的属性，可以将required设置成false</span></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//当有多个实现类实现一个接口时，注入时会报异常，所有要指定一个实现类 @quailfier是和autowired搭配使用的</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;userDaoImpl&quot;)</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line">    <span class="comment">//了解即可</span></span><br><span class="line">    <span class="meta">@AutoWired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(<span class="meta">@Qualifier(&quot;userDaoImpl&quot;)</span>UserDao userDao)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testUserDao</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(user);</span><br><span class="line">        userDao.add();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">()</span> &#123;</span><br><span class="line">        userDao.add();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="自动装配（注入）的过程："><a href="#自动装配（注入）的过程：" class="headerlink" title="自动装配（注入）的过程："></a>自动装配（注入）的过程：</h3><h4 id="Autowired"><a href="#Autowired" class="headerlink" title="@Autowired"></a>@Autowired</h4><p>①   根据属性的类型实现自动装配。</p>
<p>②   如果IOC容器中该属性的类型的bean存在多个，则以属性名作为id从IOC容器中寻找以实现自动装配，找到则装配成功；找不到则抛出异常。</p>
<p>③   如果IOC容器中该属性的类型的bean存在多个，并且以属性名作为id从IOC容器中寻找也无法实现自动装配，还可以通过@Qualifier注解指定bean的名称实现自动装配。@Qualifiter注解也可以标注在方法的形参前面。</p>
<h4 id="2-Resource注解（了解）"><a href="#2-Resource注解（了解）" class="headerlink" title="2 )     @Resource注解（了解）"></a>2 )     @Resource注解（了解）</h4><p>@Resource注解要求提供一个bean名称的属性，若该属性为空，则自动采用标注处的变量或方法名作为bean的名称。</p>
<h4 id="3-Inject注解（了解）"><a href="#3-Inject注解（了解）" class="headerlink" title="3 )     @Inject注解（了解）"></a>3 )     @Inject注解（了解）</h4><p>@Inject和@Autowired注解一样也是按类型注入匹配的bean，但没有required属性。</p>
<h4 id="4-Value注解"><a href="#4-Value注解" class="headerlink" title="4 )     @Value注解"></a>4 )     @Value注解</h4><p>注入普通类型的属性，如String类型。</p>
<h3 id="完全注解开发"><a href="#完全注解开发" class="headerlink" title="完全注解开发"></a>完全注解开发</h3><h4 id="1-Configuration"><a href="#1-Configuration" class="headerlink" title="1)     @Configuration"></a>1)     @Configuration</h4><p>添加了该注解的类将是一个配置类，用来代替xml配置文件</p>
<h4 id="2-ComponentScan"><a href="#2-ComponentScan" class="headerlink" title="2)     @ComponentScan"></a>2)     @ComponentScan</h4><p>配置要扫描的包</p>
<h4 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Configurable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-23$-14:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.atguigu&quot;)</span></span><br><span class="line"><span class="meta">@Configurable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><p>测试时创建IOC容器的类AnnotationConfigApplicationContext</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-23$-14:40</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//获取上下文的的ApplicationContext的 基于注解的开发</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTestAnnotation</span> &#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">   <span class="comment">//创建IOC容器对象</span></span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(ApplicationConfig.class);</span><br><span class="line">    <span class="comment">//从IOC容器中获取UserService对象</span></span><br><span class="line">    <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) ioc.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">    System.out.println(userService);</span><br><span class="line">    userService.saveUser();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Spring集成Junit"><a href="#Spring集成Junit" class="headerlink" title="Spring集成Junit"></a>Spring集成Junit</h3><p>​      因为Spring提供了对Junit的集成，所以可以在测试类中直接注入IOC容器中的对象，使用此功能需要导入spring-test-5.3.1.jar</p>
<h4 id="1-ContextConfiguration"><a href="#1-ContextConfiguration" class="headerlink" title="1)     @ContextConfiguration"></a>1)     @ContextConfiguration</h4><p>指定Spring的配置文件的路径</p>
<h4 id="2-RunWith"><a href="#2-RunWith" class="headerlink" title="2)     @RunWith"></a>2)     @RunWith</h4><p>指定Spring环境下运行Junit4的运行器</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.atguigu.config.ApplicationConfig;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.ContextConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringJUnit4ClassRunner;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-23$-14:40</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//@Runwith :配置spring的单元测试的启动器</span></span><br><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="comment">//然后还要进行application的配置文件的指定，也就是对ioc容器的配置文件进行指定；</span></span><br><span class="line">		<span class="comment">//1、可以用xml形式</span></span><br><span class="line">		<span class="comment">//2、可以使用annotation 注解形式；注解形式要注意，在配置文件  				中不要忘记进行扫描包</span></span><br><span class="line"><span class="comment">//基于xml形式的开发</span></span><br><span class="line"><span class="comment">//@ContextConfiguration(locations = &quot;classpath:beans-annotation.xml&quot;)</span></span><br><span class="line"><span class="comment">//获取上下文的的ApplicationContext的 基于注解的开发</span></span><br><span class="line"><span class="meta">@ContextConfiguration(classes = ApplicationConfig.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyTestAnnotation</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Qualifier(&quot;userSerivceImpl1&quot;)</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">        userService.add();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ApplicationConfig：这个是我自己写的，资源配置文件"><a href="#ApplicationConfig：这个是我自己写的，资源配置文件" class="headerlink" title="ApplicationConfig：这个是我自己写的，资源配置文件"></a>ApplicationConfig：这个是我自己写的，资源配置文件</h3><p>.java的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Configurable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.ComponentScan;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-23$-14:33</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &quot;com.atguigu&quot;)</span></span><br><span class="line"><span class="meta">@Configurable</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="第4章-AOP"><a href="#第4章-AOP" class="headerlink" title="第4章 AOP"></a>第4章 AOP</h1><h2 id="引入案例"><a href="#引入案例" class="headerlink" title="引入案例"></a>引入案例</h2><h3 id="需求：实现计算器加减乘除功能"><a href="#需求：实现计算器加减乘除功能" class="headerlink" title="需求：实现计算器加减乘除功能"></a>需求：实现计算器加减乘除功能</h3><h5 id="1、接口"><a href="#1、接口" class="headerlink" title="1、接口"></a>1、接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.spring.log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a , <span class="type">int</span> b)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a , <span class="type">int</span> b)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> a , <span class="type">int</span> b)</span>;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> a , <span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2、实现"><a href="#2、实现" class="headerlink" title="2、实现"></a>2、实现</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.spring.log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorImpl</span> <span class="keyword">implements</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> a + b;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> a - b;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> a * b;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> a / b;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="功能扩展：在计算结果的前后打印日志"><a href="#功能扩展：在计算结果的前后打印日志" class="headerlink" title="功能扩展：在计算结果的前后打印日志"></a>功能扩展：在计算结果的前后打印日志</h4><h5 id="3、在每个方法计算结果的前后打印日志"><a href="#3、在每个方法计算结果的前后打印日志" class="headerlink" title="3、在每个方法计算结果的前后打印日志"></a>3、在每个方法计算结果的前后打印日志</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.spring.log;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorImpl2</span> <span class="keyword">implements</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Logging: The method add begins with [&quot;</span>+a+<span class="string">&quot;,&quot;</span>+b+<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> a + b;</span><br><span class="line">        System.out.println(<span class="string">&quot;Logging: The method add returns &quot;</span>+result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Logging: The method sub begins with [&quot;</span>+a+<span class="string">&quot;,&quot;</span>+b+<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> a - b;</span><br><span class="line">        System.out.println(<span class="string">&quot;Logging: The method sub returns &quot;</span>+result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Logging: The method mul begins with [&quot;</span>+a+<span class="string">&quot;,&quot;</span>+b+<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> a * b;</span><br><span class="line">        System.out.println(<span class="string">&quot;Logging: The method mul returns &quot;</span>+result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Logging: The method div begins with [&quot;</span>+a+<span class="string">&quot;,&quot;</span>+b+<span class="string">&quot;]&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> a / b;</span><br><span class="line">        System.out.println(<span class="string">&quot;Logging: The method div returns &quot;</span>+result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>4、  问题：</p>
<ol>
<li><pre><code>代码混乱：越来越多的非业务需求(日志)加入后，原有的业务方法急剧膨胀。每个方法在处理核心逻辑的同时还必须兼顾其他多个关注点。
</code></pre>
</li>
<li><pre><code>代码分散: 只是为了满足这个单一需求，就不得不在多个模块（方法）里多次重复相同的日志代码。如果日志需求发生变化，必须修改所有模块。
</code></pre>
</li>
</ol>
<h4 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h4><h5 id="1-动态代理的原理"><a href="#1-动态代理的原理" class="headerlink" title="1)     动态代理的原理"></a>1)     动态代理的原理</h5><blockquote>
<p>代理设计模式的原理：使用一个代理将原本对象包装起来，然后用该代理对象”取代”原始对象。任何对原始对象的调用都要通过代理。代理对象决定是否以及何时将方法调用转到原始对象上。</p>
</blockquote>
<p><img src="/img%5C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86.png" alt="动态代理"></p>
<h5 id="2-动态代理的方式"><a href="#2-动态代理的方式" class="headerlink" title="2)     动态代理的方式"></a>2)     动态代理的方式</h5><p>a)     基于<strong>接口实现动态代理</strong>： <strong>JDK动态代理</strong></p>
<p>b)     基于<strong>继承实现动态代理</strong>： <strong>Cglib</strong>、<strong>Javassist动态代理</strong></p>
<h5 id="3-JDK动态代理核心类"><a href="#3-JDK动态代理核心类" class="headerlink" title="3)    JDK动态代理核心类"></a>3)    JDK动态代理核心类</h5><p><img src="/img%5C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E7%B1%BB.png" alt="动态代理类"></p>
<h5 id="4-核心方法"><a href="#4-核心方法" class="headerlink" title="4)    核心方法"></a>4)    核心方法</h5><p><img src="/img%5C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E7%B1%BB%E7%9A%84%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81.png" alt="动态代理类的核心代码"></p>
<p>5、处理器接口</p>
<p><img src="/img%5C%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E7%9A%84%E6%A0%B8%E5%BF%83%E6%96%B9%E6%B3%95%E7%9A%84%E5%A4%84%E7%90%86%E5%99%A8.png" alt="动态代理的核心方法的处理器"></p>
<h4 id="使用JDK动态代理实现日志的打印-实例"><a href="#使用JDK动态代理实现日志的打印-实例" class="headerlink" title="使用JDK动态代理实现日志的打印(实例)"></a>使用JDK动态代理实现日志的打印(实例)</h4><h5 id="1、接口-1"><a href="#1、接口-1" class="headerlink" title="1、接口"></a>1、接口</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-23$-16:15</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2、原始对象"><a href="#2、原始对象" class="headerlink" title="2、原始对象"></a>2、原始对象</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-23$-16:16</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CalculatorImpl</span> <span class="keyword">implements</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">results</span> <span class="operator">=</span> a + b;</span><br><span class="line">        <span class="keyword">return</span> results;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sub</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">results</span> <span class="operator">=</span> a - b;</span><br><span class="line">        <span class="keyword">return</span> results;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">mul</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">results</span> <span class="operator">=</span> a * b;</span><br><span class="line">        <span class="keyword">return</span> results;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">div</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">results</span> <span class="operator">=</span> a / b;</span><br><span class="line">        <span class="keyword">return</span> results;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3、动态代理类"><a href="#3、动态代理类" class="headerlink" title="3、动态代理类"></a>3、动态代理类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-23$-16:19</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProxy</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//动态创建代理类</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyProxy</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">getProxy</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * 调用处理器 可以在处理器中写拓展的代码，当调用代理类对象方法时，拓展方法将被执行1!</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> proxy  代理类对象，但是现在使用不到的</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> method  核心方法，也就是原始对象的接口方法。也可以说是核心方法</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@param</span> args  核心方法的参数参数</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@return</span> 返回创建的代理对象</span></span><br><span class="line"><span class="comment">             * <span class="doctag">@throws</span> Throwable</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;现在执行了&quot;</span> + method.getName() + <span class="string">&quot;方法&quot;</span>);</span><br><span class="line">                <span class="type">Object</span> <span class="variable">invoke</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">                System.out.println(<span class="string">&quot;方法的参数为：&quot;</span> + Arrays.toString(args));</span><br><span class="line">                <span class="keyword">return</span> invoke;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">return</span> o;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4、测试类"><a href="#4、测试类" class="headerlink" title="4、测试类"></a>4、测试类</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-25$-0:11</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestCalculator</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用动态代理来实现log日志打印功能的实现！</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//创建原始类</span></span><br><span class="line">        <span class="type">Calculator</span> <span class="variable">calculator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CalculatorImpl</span>();</span><br><span class="line">        <span class="comment">//创建动态代理类</span></span><br><span class="line">        <span class="comment">//在这里必须使用接口类型来接收，因为代理类也实现类接口，如果用接口的实现类接收，会报类型转换异常；</span></span><br><span class="line">        <span class="type">Calculator</span> <span class="variable">calculatorProxy</span> <span class="operator">=</span> (Calculator) <span class="keyword">new</span> <span class="title class_">MyProxy</span>(calculator).getProxy();</span><br><span class="line">        <span class="type">int</span> <span class="variable">add</span> <span class="operator">=</span> calculatorProxy.add(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(add);</span><br><span class="line">        <span class="type">int</span> <span class="variable">sub</span> <span class="operator">=</span> calculatorProxy.sub(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(sub);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="AOP概述"><a href="#AOP概述" class="headerlink" title="AOP概述"></a>AOP概述</h2><p><strong>1)     AOP(Aspect-Oriented Programming，面向切面编程)：是一种新的方法论，是对传统 OOP(Object-Oriented Programming，面向对象编程)的补充。是一种通过动态代理实现程序功能扩展和统一维护的一种技术。</strong></p>
<p><strong>2)     利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高了开发的效率。</strong></p>
<p><strong>3)     AOP编程操作的主要对象是切面(aspect)，而切面用于模块化横切关注点（公共功能）。</strong></p>
<h4 id="AOP的好处："><a href="#AOP的好处：" class="headerlink" title="AOP的好处："></a>AOP的好处：</h4><p>​           <strong>a)     每个事物逻辑位于一个位置，代码不分散，便于维护和升级</strong></p>
<p>​           <strong>b)     业务模块更简洁，只包含核心业务代码</strong> </p>
<h4 id="AOP图解："><a href="#AOP图解：" class="headerlink" title="AOP图解："></a>AOP图解：</h4><p><img src="/img%5CAop%E5%9B%BE%E8%A7%A3.png" alt="Aop图解"></p>
<h4 id="AOP术语"><a href="#AOP术语" class="headerlink" title="AOP术语"></a>AOP术语</h4><h5 id="1-横切关注点"><a href="#1-横切关注点" class="headerlink" title="1)     横切关注点"></a>1)     横切关注点</h5><p>​    从每个方法中抽取出来的同一类非核心业务。</p>
<h5 id="2-切面-Aspect"><a href="#2-切面-Aspect" class="headerlink" title="2)     切面(Aspect)"></a>2)     切面(Aspect)</h5><p>​    封装横切关注点信息的类，每个关注点体现为一个通知方法。</p>
<h5 id="3-通知-Advice"><a href="#3-通知-Advice" class="headerlink" title="3)     通知(Advice)"></a>3)     通知(Advice)</h5><p>​    切面必须要完成的各个具体工作</p>
<h5 id="4-目标-Target"><a href="#4-目标-Target" class="headerlink" title="4)     目标(Target)"></a>4)     目标(Target)</h5><p>​    被通知的对象</p>
<h5 id="5-代理-Proxy"><a href="#5-代理-Proxy" class="headerlink" title="5)     代理(Proxy)"></a>5)     代理(Proxy)</h5><p>​    向目标对象应用通知之后创建的代理对象</p>
<h5 id="6-连接点-Joinpoint"><a href="#6-连接点-Joinpoint" class="headerlink" title="6)     连接点(Joinpoint)"></a>6)     连接点(Joinpoint)</h5><p>​    横切关注点在程序代码中的具体位置</p>
<h5 id="7-切入点-pointcut"><a href="#7-切入点-pointcut" class="headerlink" title="7)     切入点(pointcut)"></a>7)     切入点(pointcut)</h5><p>​    定位连接点的方式。每个类的方法中都包含多个连接点，所以连接点是类中客观存在的事物。如果把连接点看作数据库中的记录，那么切入点就是查询条件——AOP可以通过切入点定位到特定的连接点。切点通过org.springframework.aop.Pointcut接口进行描述，它使用类和方法作为连接点的查询条件。</p>
<h3 id="AspectJ"><a href="#AspectJ" class="headerlink" title="AspectJ"></a>AspectJ</h3><h4 id="1-简介"><a href="#1-简介" class="headerlink" title="1)     简介"></a>1)     简介</h4><p>​      Java社区里最完整最流行的AOP框架。</p>
<p>​      在Spring2.0以上版本中，可以使用基于AspectJ注解或基于XML配置的AOP。</p>
<h4 id="2-Aspect注解"><a href="#2-Aspect注解" class="headerlink" title="2)     @Aspect注解"></a>2)     @Aspect注解</h4><p>​      在Spring中声明切面使用@Aspect注解，而且切面也需要交给IOC容器管理，即切面上也需要添加@Component注解。</p>
<p>​      当在Spring IOC容器中初始化AspectJ切面之后，Spring IOC容器就会为那些与 AspectJ切面相匹配的bean创建代理。</p>
<p>​      在AspectJ注解中，切面只是一个带有@Aspect注解的Java类，它往往要包含很多通知，通知是标注有某种注解的简单的Java方法。</p>
<h4 id="3-AspectJ支持5种类型的通知注解："><a href="#3-AspectJ支持5种类型的通知注解：" class="headerlink" title="3)     AspectJ支持5种类型的通知注解："></a>3)     AspectJ支持5种类型的通知注解：</h4><h6 id="①-Before：前置通知，在方法执行之前执行"><a href="#①-Before：前置通知，在方法执行之前执行" class="headerlink" title="①   @Before：前置通知，在方法执行之前执行"></a>①   @Before：前置通知，在方法执行之前执行</h6><h6 id="②-After：后置通知，在方法执行之后执行"><a href="#②-After：后置通知，在方法执行之后执行" class="headerlink" title="②   @After：后置通知，在方法执行之后执行"></a>②   @After：后置通知，在方法执行之后执行</h6><h6 id="③-AfterRunning：返回通知，在方法返回结果之后执行"><a href="#③-AfterRunning：返回通知，在方法返回结果之后执行" class="headerlink" title="③   @AfterRunning：返回通知，在方法返回结果之后执行"></a>③   @AfterRunning：返回通知，在方法返回结果之后执行</h6><h6 id="④-AfterThrowing：异常通知，在方法抛出异常之后执行"><a href="#④-AfterThrowing：异常通知，在方法抛出异常之后执行" class="headerlink" title="④   @AfterThrowing：异常通知，在方法抛出异常之后执行"></a>④   @AfterThrowing：异常通知，在方法抛出异常之后执行</h6><h6 id="⑤-Around：环绕通知，围绕着方法执行，相当于动态代理的全过程"><a href="#⑤-Around：环绕通知，围绕着方法执行，相当于动态代理的全过程" class="headerlink" title="⑤   @Around：环绕通知，围绕着方法执行，相当于动态代理的全过程"></a>⑤   @Around：环绕通知，围绕着方法执行，相当于动态代理的全过程</h6><h4 id="在Spring中使用AOP的步骤："><a href="#在Spring中使用AOP的步骤：" class="headerlink" title="在Spring中使用AOP的步骤："></a>在Spring中使用AOP的步骤：</h4><h5 id="1-在Spring核心包的基础上添加以下jar包"><a href="#1-在Spring核心包的基础上添加以下jar包" class="headerlink" title="1)     在Spring核心包的基础上添加以下jar包"></a>1)     在Spring核心包的基础上添加以下jar包</h5><blockquote>
<p> spring-aspects-5.3.1.jar</p>
<p>com.springsource.org.aspectj.weaver-1.6.8.RELEASE.jar</p>
</blockquote>
<h5 id="2-创建Spring的配置文件，配置自动扫描的包和AspectJ注解支持"><a href="#2-创建Spring的配置文件，配置自动扫描的包和AspectJ注解支持" class="headerlink" title="2)    创建Spring的配置文件，配置自动扫描的包和AspectJ注解支持"></a>2)    创建Spring的配置文件，配置自动扫描的包和AspectJ注解支持</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">&lt;!--配置自动扫描的包--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu.aop.aspect&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开启AspectJ注解支持--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="3-创建一个类作为切面"><a href="#3-创建一个类作为切面" class="headerlink" title="3)  创建一个类作为切面"></a>3)  创建一个类作为切面</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-25$-9:34</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-在切面中添加通知方法"><a href="#4-在切面中添加通知方法" class="headerlink" title="4)   在切面中添加通知方法"></a>4)   在切面中添加通知方法</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//复用表达式</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* Calculator.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在通知之前执行叫前置通知</span></span><br><span class="line">    <span class="comment">// 在@Before注解里要有连接点表达式(&quot;execution(权限修饰符 返回值类型 方法的全类名(参数类型，参数类型...))&quot;)</span></span><br><span class="line"> <span class="comment">/*   @Before(&quot;execution(public int com.atguigu.aop.aspect.logging.Calculator.*(int,int))&quot;)</span></span><br><span class="line"><span class="comment">    public void beforeAdvice(JoinPoint joinPoint)&#123;</span></span><br><span class="line"><span class="comment">        String name = joinPoint.getSignature().getName();</span></span><br><span class="line"><span class="comment">        Object[] args = joinPoint.getArgs();</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;在&quot;+name+&quot;方法之前调用！参数为：&quot;+ Arrays.toString(args));</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line">    <span class="comment">//在通知之前执行叫前置通知</span></span><br><span class="line">    <span class="comment">// 在@Before注解里要有连接点表达式(&quot;execution(权限修饰符 返回值类型 方法的全类名(参数类型，参数类型...))&quot;)</span></span><br><span class="line">   <span class="comment">/* @After(&quot;execution(* Calculator.*(..))&quot;)</span></span><br><span class="line"><span class="comment">    public void afterAdvice(JoinPoint joinpoint)&#123;</span></span><br><span class="line"><span class="comment">        Object target = joinpoint.getTarget();</span></span><br><span class="line"><span class="comment">        System.out.println(&quot;调用！&quot;+target);</span></span><br><span class="line"><span class="comment">    &#125;*/</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint pro)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> pro.getSignature().getName();</span><br><span class="line">        Object[] args = pro.getArgs();</span><br><span class="line">        Object proceed=<span class="literal">null</span>;</span><br><span class="line">        System.out.println(name+<span class="string">&quot;方法的前置通知！参数类型&quot;</span>+Arrays.toString(args));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            proceed = pro.proceed();</span><br><span class="line">            System.out.println(name+<span class="string">&quot;的返回通知！返回值为：&quot;</span>+proceed);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;的异常通知！&quot;</span>);</span><br><span class="line">            <span class="comment">// throwable.printStackTrace();</span></span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;后置通知！方法结束&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-测试"><a href="#5-测试" class="headerlink" title="5)   测试"></a>5)   测试</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestAop</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test01</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;application.xml&quot;</span>);</span><br><span class="line">        <span class="type">Calculator</span> <span class="variable">calculator</span> <span class="operator">=</span> (Calculator) ioc.getBean(<span class="string">&quot;calculatorImpl&quot;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">add</span> <span class="operator">=</span> calculator.add(<span class="number">12</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;add = &quot;</span> + add);</span><br><span class="line">        <span class="type">int</span> <span class="variable">sub</span> <span class="operator">=</span> calculator.sub(<span class="number">12</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;sub = &quot;</span> + sub);</span><br><span class="line">        <span class="type">int</span> <span class="variable">mul</span> <span class="operator">=</span> calculator.mul(<span class="number">12</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;mul = &quot;</span> + mul);</span><br><span class="line">        <span class="type">int</span> <span class="variable">div</span> <span class="operator">=</span> calculator.div(<span class="number">12</span>, <span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;div = &quot;</span> + div);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>测试结果：在add、sub、mul、div方法执行之前执行切面中的beforeAdvice方法</strong></p>
<h3 id="AOP细节"><a href="#AOP细节" class="headerlink" title="AOP细节"></a>AOP细节</h3><h4 id="切入点表达式"><a href="#切入点表达式" class="headerlink" title="切入点表达式"></a>切入点表达式</h4><ol>
<li><pre><code>作用
</code></pre>
</li>
</ol>
<p>通过表达式的方式定位一个或多个具体的连接点。</p>
<ol start="2">
<li><pre><code>语法格式：
</code></pre>
</li>
</ol>
<p>execution([权限修饰符] [返回值类型] [简单类名&#x2F;全类名] [<a href="">方法名[参数列表])</a></p>
<ol start="3">
<li><pre><code>举例说明:
</code></pre>
</li>
</ol>
<table>
<thead>
<tr>
<th>表达式</th>
<th>execution(*com.atguigu.spring.aop.Calculator.*(..))</th>
</tr>
</thead>
<tbody><tr>
<td>含义</td>
<td>Calculator接口中声明的所有方法。   第一个“*”代表任意修饰符及任意返回值。   第二个“*”代表任意方法。   “..”匹配任意数量、任意类型的参数。   若目标类、接口与该切面类在同一个包中可以省略包名。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>表达式</th>
<th>execution(public   * Calculator.*(..))</th>
</tr>
</thead>
<tbody><tr>
<td>含义</td>
<td>Calculator接口中声明的所有公有方法</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>表达式</th>
<th>execution(public   int Calculator.*(..))</th>
</tr>
</thead>
<tbody><tr>
<td>含义</td>
<td>Calculator接口中声明的返回值为int类型的公有方法</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>表达式</th>
<th>execution(public   int Calculator.*(int, ..))</th>
</tr>
</thead>
<tbody><tr>
<td>含义</td>
<td>第一个参数为int类型的共有方法。   “..” 匹配任意数量、任意类型的参数。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>表达式</th>
<th>execution(public   int Calculator.*(int, int))</th>
</tr>
</thead>
<tbody><tr>
<td>含义</td>
<td>参数类型为int，int类型的方法</td>
</tr>
</tbody></table>
<h5 id="4-在AspectJ中，切入点表达式可以通过-“-amp-amp-”、“-”、“-”等操作符结合起来"><a href="#4-在AspectJ中，切入点表达式可以通过-“-amp-amp-”、“-”、“-”等操作符结合起来" class="headerlink" title="4)     在AspectJ中，切入点表达式可以通过 “&amp;&amp;”、“||”、“!”等操作符结合起来"></a>4)     在AspectJ中，切入点表达式可以通过 “&amp;&amp;”、“||”、“!”等操作符结合起来</h5><table>
<thead>
<tr>
<th>表达式</th>
<th>execution   (* <em>.add(int,..)) || execution(</em> *.sub(int,..))</th>
</tr>
</thead>
<tbody><tr>
<td>含义</td>
<td>任意类中第一个参数为int类型的add方法或sub方法</td>
</tr>
<tr>
<td>表达式</td>
<td>!execution   (* *.add(int,..))</td>
</tr>
<tr>
<td>含义</td>
<td>匹配不是任意类中第一个参数为int类型的add方法</td>
</tr>
</tbody></table>
<h4 id="连接点细节"><a href="#连接点细节" class="headerlink" title="连接点细节"></a>连接点细节</h4><blockquote>
<p>切入点表达式通常都会是从宏观上定位一组方法，和具体某个通知的注解结合起来就能够确定对应的连接点。那么就一个具体的连接点而言，我们可能会关心这个连接点的一些具体信息，例如：当前连接点所在方法的方法名、当前传入的参数值等等。这些信息都封装在<strong>JoinPoint</strong>接口的实例对象中。</p>
</blockquote>
<p><img src="/img%5CJoinPoint%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90.png" alt="JoinPoint源码分析.png"></p>
<h3 id="通知细节"><a href="#通知细节" class="headerlink" title="通知细节"></a>通知细节</h3><h4 id="1-概述"><a href="#1-概述" class="headerlink" title="1)     概述"></a>1)     概述</h4><ul>
<li>通知即在具体的连接点上要执行的操作。</li>
<li>一个切面可以包括一个或者多个通知。</li>
<li>通知所使用的注解的值往往是切入点表达式。</li>
</ul>
<h4 id="2-前置通知"><a href="#2-前置通知" class="headerlink" title="2)     前置通知"></a>2)     前置通知</h4><h5 id="n-使用-Before注解标识"><a href="#n-使用-Before注解标识" class="headerlink" title="n  使用@Before注解标识"></a>n  使用@Before注解标识</h5><h5 id="n-在方法执行之前执行的通知。"><a href="#n-在方法执行之前执行的通知。" class="headerlink" title="n  在方法执行之前执行的通知。"></a>n  在方法执行之前执行的通知。</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before(&quot;execution(public int com.atguigu.aop.aspect.logging.Calculator.*(int,int))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeAdvice</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">    Object[] args = joinPoint.getArgs();</span><br><span class="line">    System.out.println(<span class="string">&quot;在&quot;</span>+name+<span class="string">&quot;方法之前调用！参数为：&quot;</span>+ Arrays.toString(args));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3）后置通知"><a href="#3）后置通知" class="headerlink" title="3）后置通知"></a>3）后置通知</h4><h5 id="n-使用-After注解标识"><a href="#n-使用-After注解标识" class="headerlink" title="n  使用@After注解标识"></a>n  使用@After注解标识</h5><h5 id="n-后置通知是在连接点完成之后执行的，即连接点返回结果或者抛出异常的时候。"><a href="#n-后置通知是在连接点完成之后执行的，即连接点返回结果或者抛出异常的时候。" class="headerlink" title="n  后置通知是在连接点完成之后执行的，即连接点返回结果或者抛出异常的时候。"></a>n  后置通知是在连接点完成之后执行的，即连接点返回结果或者抛出异常的时候。</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@After(&quot;execution(* Calculator.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterAdvice</span><span class="params">(JoinPoint joinpoint)</span>&#123;</span><br><span class="line">    <span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> joinpoint.getTarget();</span><br><span class="line">    System.out.println(<span class="string">&quot;调用！&quot;</span>+target);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-返回通知"><a href="#4-返回通知" class="headerlink" title="4)    返回通知"></a>4)    返回通知</h4><h5 id="n-使用-AfterReturning注解标识"><a href="#n-使用-AfterReturning注解标识" class="headerlink" title="n  使用@AfterReturning注解标识"></a>n  使用@AfterReturning注解标识</h5><h5 id="n-无论连接点是正常返回还是抛出异常，后置通知都会执行。如果只想在连接点返回的时候记录日志，应使用返回通知代替后置通知。"><a href="#n-无论连接点是正常返回还是抛出异常，后置通知都会执行。如果只想在连接点返回的时候记录日志，应使用返回通知代替后置通知。" class="headerlink" title="n  无论连接点是正常返回还是抛出异常，后置通知都会执行。如果只想在连接点返回的时候记录日志，应使用返回通知代替后置通知。"></a>n  无论连接点是正常返回还是抛出异常，后置通知都会执行。如果只想在连接点返回的时候记录日志，应使用返回通知代替后置通知。</h5><h6 id="u-在返回通知中，通过-AfterReturning注解的returning属性获取连接-点的返回值。该属性的值即为用来传入返回值的参数名称"><a href="#u-在返回通知中，通过-AfterReturning注解的returning属性获取连接-点的返回值。该属性的值即为用来传入返回值的参数名称" class="headerlink" title="u  在返回通知中，通过@AfterReturning注解的returning属性获取连接            点的返回值。该属性的值即为用来传入返回值的参数名称"></a>u  在返回通知中，通过@AfterReturning注解的returning属性获取连接            点的返回值。该属性的值即为用来传入返回值的参数名称</h6><h6 id="u-必须在通知方法的签名中添加一个同名参数。在运行时Spring-AOP会通过这个参数传递返回值"><a href="#u-必须在通知方法的签名中添加一个同名参数。在运行时Spring-AOP会通过这个参数传递返回值" class="headerlink" title="u  必须在通知方法的签名中添加一个同名参数。在运行时Spring AOP会通过这个参数传递返回值"></a>u  必须在通知方法的签名中添加一个同名参数。在运行时Spring AOP会通过这个参数传递返回值</h6><h6 id="u-原始的切点表达式需要出现在pointcut属性中"><a href="#u-原始的切点表达式需要出现在pointcut属性中" class="headerlink" title="u  原始的切点表达式需要出现在pointcut属性中"></a>u  原始的切点表达式需要出现在pointcut属性中</h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterReturning(pointcut = &quot;execution(* Calculator.*(..))&quot;,returning = &quot;result&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(JoinPoint joinPoint, Object result)</span>&#123;</span><br><span class="line">    Object[] args = joinPoint.getArgs();</span><br><span class="line">    System.out.println(Arrays.toString(args)+<span class="string">&quot;★AfterReturning这个是&quot;</span>+result);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h4 id="5-异常通知"><a href="#5-异常通知" class="headerlink" title="5)异常通知"></a>5)异常通知</h4><h5 id="n-使用-AfterThrowing注解标识"><a href="#n-使用-AfterThrowing注解标识" class="headerlink" title="n  使用@AfterThrowing注解标识"></a>n  使用@AfterThrowing注解标识</h5><h5 id="n-在异常通知中，通过-AfterThrowing注解的throwing属性获取异常信息。Throwable是所有错误和异常类的顶级父类，所以在异常通知方法可以捕获到任何错误和异常。"><a href="#n-在异常通知中，通过-AfterThrowing注解的throwing属性获取异常信息。Throwable是所有错误和异常类的顶级父类，所以在异常通知方法可以捕获到任何错误和异常。" class="headerlink" title="n  在异常通知中，通过@AfterThrowing注解的throwing属性获取异常信息。Throwable是所有错误和异常类的顶级父类，所以在异常通知方法可以捕获到任何错误和异常。"></a>n  在异常通知中，通过@AfterThrowing注解的throwing属性获取异常信息。Throwable是所有错误和异常类的顶级父类，所以在异常通知方法可以捕获到任何错误和异常。</h5><h5 id="n-如果只对某种特殊的异常类型感兴趣，可以将参数声明为其他异常的参数类型。然后通知就只在抛出这个类型及其子类的异常时才被执行。"><a href="#n-如果只对某种特殊的异常类型感兴趣，可以将参数声明为其他异常的参数类型。然后通知就只在抛出这个类型及其子类的异常时才被执行。" class="headerlink" title="n  如果只对某种特殊的异常类型感兴趣，可以将参数声明为其他异常的参数类型。然后通知就只在抛出这个类型及其子类的异常时才被执行。"></a>n  如果只对某种特殊的异常类型感兴趣，可以将参数声明为其他异常的参数类型。然后通知就只在抛出这个类型及其子类的异常时才被执行。</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AfterThrowing(value = &quot;execution(* Calculator.*(..))&quot;,throwing = &quot;e&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable e)</span>&#123;</span><br><span class="line">     System.out.println(joinPoint.getSignature().getName()+<span class="string">&quot;★AfterThrowing发生异常了:&quot;</span>+e);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>



<h4 id="6-）环绕通知"><a href="#6-）环绕通知" class="headerlink" title="6 ）环绕通知"></a>6 ）环绕通知</h4><h5 id="n-通过-Around注解标识"><a href="#n-通过-Around注解标识" class="headerlink" title="n  通过@Around注解标识"></a>n  通过@Around注解标识</h5><h5 id="n-环绕通知是所有通知类型中功能最为强大的，能够全面地控制连接点，甚至可以控制是否执行连接点。"><a href="#n-环绕通知是所有通知类型中功能最为强大的，能够全面地控制连接点，甚至可以控制是否执行连接点。" class="headerlink" title="n  环绕通知是所有通知类型中功能最为强大的，能够全面地控制连接点，甚至可以控制是否执行连接点。"></a>n  环绕通知是所有通知类型中功能最为强大的，能够全面地控制连接点，甚至可以控制是否执行连接点。</h5><h5 id="n-对于环绕通知来说，连接点的参数类型必须是ProceedingJoinPoint。它是-JoinPoint的子接口，允许控制何时执行，是否执行连接点。"><a href="#n-对于环绕通知来说，连接点的参数类型必须是ProceedingJoinPoint。它是-JoinPoint的子接口，允许控制何时执行，是否执行连接点。" class="headerlink" title="n  对于环绕通知来说，连接点的参数类型必须是ProceedingJoinPoint。它是 JoinPoint的子接口，允许控制何时执行，是否执行连接点。"></a>n  对于环绕通知来说，连接点的参数类型必须是ProceedingJoinPoint。它是 JoinPoint的子接口，允许控制何时执行，是否执行连接点。</h5><h5 id="n-在环绕通知中需要明确调用ProceedingJoinPoint的proceed-方法来执行被代理的方法。如果忘记这样做就会导致通知被执行了，但目标方法没有被执行。"><a href="#n-在环绕通知中需要明确调用ProceedingJoinPoint的proceed-方法来执行被代理的方法。如果忘记这样做就会导致通知被执行了，但目标方法没有被执行。" class="headerlink" title="n  在环绕通知中需要明确调用ProceedingJoinPoint的proceed()方法来执行被代理的方法。如果忘记这样做就会导致通知被执行了，但目标方法没有被执行。"></a>n  在环绕通知中需要明确调用ProceedingJoinPoint的proceed()方法来执行被代理的方法。如果忘记这样做就会导致通知被执行了，但目标方法没有被执行。</h5><h5 id="n-注意：环绕通知的方法需要返回目标方法执行之后的结果，即调用-joinPoint-proceed-的返回值，否则会出现异常"><a href="#n-注意：环绕通知的方法需要返回目标方法执行之后的结果，即调用-joinPoint-proceed-的返回值，否则会出现异常" class="headerlink" title="n  注意：环绕通知的方法需要返回目标方法执行之后的结果，即调用 joinPoint.proceed()的返回值，否则会出现异常"></a>n  注意：环绕通知的方法需要返回目标方法执行之后的结果，即调用 joinPoint.proceed()的返回值，否则会出现异常</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Around(&quot;execution(* Calculator.*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint pro)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> pro.getSignature().getName();</span><br><span class="line">        Object[] args = pro.getArgs();</span><br><span class="line">        Object proceed=<span class="literal">null</span>;</span><br><span class="line">        System.out.println(name+<span class="string">&quot;方法的前置通知！参数类型&quot;</span>+Arrays.toString(args));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            proceed = pro.proceed();</span><br><span class="line">            System.out.println(name+<span class="string">&quot;的返回通知！返回值为：&quot;</span>+proceed);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;的异常通知！&quot;</span>);</span><br><span class="line">            <span class="comment">// throwable.printStackTrace();</span></span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;后置通知！方法结束&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h3 id="重用切入点表达式"><a href="#重用切入点表达式" class="headerlink" title="重用切入点表达式"></a>重用切入点表达式</h3><ol>
<li>在AspectJ切面中，可以通过@Pointcut注解将一个切入点声明成简单的方法。切入点的方法体通常是空的，因为将切入点定义与应用程序逻辑混在一起是不合理的。</li>
<li><strong>其他通知可以通过方法名称引入该切入点</strong></li>
<li>切入点方法的访问控制符同时也控制着这个切入点的可见性。如果切入点要在多个切面中共用，最好将它们集中在一个公共的类中。在这种情况下，它们必须被声明为public。在引入这个切入点时，必须将类名也包括在内。如果类没有与这个切面放在同一个包中，还必须包含包名。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//复用表达式</span></span><br><span class="line">   <span class="meta">@Pointcut(&quot;execution(* Calculator.*(..))&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> <span class="meta">@Around(&quot;pointCut()&quot;)</span></span><br><span class="line">   <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint pro)</span>&#123;</span><br><span class="line">       <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> pro.getSignature().getName();</span><br><span class="line">       Object[] args = pro.getArgs();</span><br><span class="line">       Object proceed=<span class="literal">null</span>;</span><br><span class="line">       System.out.println(name+<span class="string">&quot;方法的前置通知！参数类型&quot;</span>+Arrays.toString(args));</span><br><span class="line">       <span class="keyword">try</span> &#123;</span><br><span class="line">           proceed = pro.proceed();</span><br><span class="line">           System.out.println(name+<span class="string">&quot;的返回通知！返回值为：&quot;</span>+proceed);</span><br><span class="line">       &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">           System.out.println(name+<span class="string">&quot;的异常通知！&quot;</span>);</span><br><span class="line">           <span class="comment">// throwable.printStackTrace();</span></span><br><span class="line">       &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">           System.out.println(name+<span class="string">&quot;后置通知！方法结束&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> proceed;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h3 id="设置切面的优先级"><a href="#设置切面的优先级" class="headerlink" title="设置切面的优先级"></a>设置切面的优先级</h3><p>  <strong>在同一个连接点上应用不止一个切面时，除非明确指定，否则它们的优先级是不确定的。</strong></p>
<ul>
<li>l  切面的优先级可以通过实现Ordered接口或利用@Order注解指定。</li>
<li>l  实现Ordered接口，getOrder()方法的返回值越小，优先级越高。</li>
<li>l  若使用@Order注解，通过注解的value属性指定优先级，值越小优先级越高。</li>
<li>验证参数的切面类：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AspectDouble</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;execution(* Calculator.*(int ,int))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">BeforeAdvice</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        System.out.println(<span class="string">&quot;这里是AspectDouble切面中的方法！方法参数为：&quot;</span>+Arrays.toString(args));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="打印日志的切面类"><a href="#打印日志的切面类" class="headerlink" title="打印日志的切面类"></a>打印日志的切面类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//@Order可以设置优先级正整数越小优先级越高</span></span><br><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> &#123;</span><br><span class="line">    <span class="comment">//复用表达式</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* Calculator.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"><span class="meta">@Around(&quot;pointCut()&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint pro)</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> pro.getSignature().getName();</span><br><span class="line">    Object[] args = pro.getArgs();</span><br><span class="line">    Object proceed=<span class="literal">null</span>;</span><br><span class="line">    System.out.println(name+<span class="string">&quot;方法的前置通知！参数类型&quot;</span>+Arrays.toString(args));</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        proceed = pro.proceed();</span><br><span class="line">        System.out.println(name+<span class="string">&quot;的返回通知！返回值为：&quot;</span>+proceed);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">        System.out.println(name+<span class="string">&quot;的异常通知！&quot;</span>);</span><br><span class="line">        <span class="comment">// throwable.printStackTrace();</span></span><br><span class="line">    &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">        System.out.println(name+<span class="string">&quot;后置通知！方法结束&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> proceed;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="通过AOP方式实现日志打印的切面类的完整内容"><a href="#通过AOP方式实现日志打印的切面类的完整内容" class="headerlink" title="通过AOP方式实现日志打印的切面类的完整内容"></a>通过AOP方式实现日志打印的切面类的完整内容</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//复用表达式</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* Calculator.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointCut</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在通知之前执行叫前置通知</span></span><br><span class="line">    <span class="comment">// 在@Before注解里要有连接点表达式(&quot;execution(权限修饰符 返回值类型 方法的全类名(参数类型，参数类型...))&quot;)</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(public int com.atguigu.aop.aspect.logging.Calculator.*(int,int))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeAdvice</span><span class="params">(JoinPoint joinPoint)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        System.out.println(<span class="string">&quot;在&quot;</span>+name+<span class="string">&quot;方法之前调用！参数为：&quot;</span>+ Arrays.toString(args));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//在通知之前执行叫前置通知</span></span><br><span class="line">    <span class="comment">// 在@Before注解里要有连接点表达式(&quot;execution(权限修饰符 返回值类型 方法的全类名(参数类型，参数类型...))&quot;)</span></span><br><span class="line">    <span class="meta">@After(&quot;execution(* Calculator.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterAdvice</span><span class="params">(JoinPoint joinpoint)</span>&#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">target</span> <span class="operator">=</span> joinpoint.getTarget();</span><br><span class="line">        System.out.println(<span class="string">&quot;调用！&quot;</span>+target);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterReturning(pointcut = &quot;execution(* Calculator.*(..))&quot;,returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">(JoinPoint joinPoint, Object result)</span>&#123;</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        System.out.println(Arrays.toString(args)+<span class="string">&quot;★AfterReturning这个是&quot;</span>+result);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;execution(* Calculator.*(..))&quot;,throwing = &quot;e&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable e)</span>&#123;</span><br><span class="line">        System.out.println(joinPoint.getSignature().getName()+<span class="string">&quot;★AfterThrowing发生异常了:&quot;</span>+e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">aroundAdvice</span><span class="params">(ProceedingJoinPoint pro)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> pro.getSignature().getName();</span><br><span class="line">        Object[] args = pro.getArgs();</span><br><span class="line">        Object proceed=<span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;☆方法的前置通知！参数类型&quot;</span>+Arrays.toString(args));</span><br><span class="line">            proceed = pro.proceed();</span><br><span class="line">            System.out.println(name+<span class="string">&quot;☆的返回通知！返回值为：&quot;</span>+proceed);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;☆的异常通知！&quot;</span>+throwable);</span><br><span class="line">            <span class="comment">// throwable.printStackTrace();</span></span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            System.out.println(name+<span class="string">&quot;☆后置通知！方法结束&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> proceed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="基于XML的方式实现AOP"><a href="#基于XML的方式实现AOP" class="headerlink" title="基于XML的方式实现AOP"></a>基于XML的方式实现AOP</h3><p>除了使用AspectJ注解声明切面，Spring也支持在bean配置文件中声明切面。这种声明是通过aop名称空间中的XML元素完成的。</p>
<p>正常情况下，基于注解的声明要优先于基于XML的声明。通过AspectJ注解，切面可以与AspectJ兼容，而基于XML的配置则是Spring专有的。由于AspectJ得到越来越多的 AOP框架支持，所以以注解风格编写的切面将会有更多重用的机会。</p>
<h4 id="1-配置细节"><a href="#1-配置细节" class="headerlink" title="1)     配置细节"></a>1)     配置细节</h4><p>在bean配置文件中，所有的Spring AOP配置都必须定义在&lt;aop:config&gt;元素内部。对于每个切面而言，都要创建一个&lt;aop:aspect&gt;元素来为具体的切面实现引用后端bean实例。</p>
<p>切面bean必须有一个标识符，供&lt;aop:aspect&gt;元素引用。</p>
<p><img src="/img%5C%E9%85%8D%E7%BD%AE%E7%BB%86%E8%8A%82.png" alt="配置细节"></p>
<h4 id="2-声明切入点"><a href="#2-声明切入点" class="headerlink" title="2)     声明切入点"></a>2)     声明切入点</h4><ul>
<li>切入点使用&lt;aop:pointcut&gt;元素声明。</li>
<li>切入点必须定义在&lt;aop:aspect&gt;元素下，或者直接定义在&lt;aop:config&gt;元素下</li>
<li>定义在&lt;aop:aspect&gt;元素下：只对当前切面有效</li>
<li>定义在&lt;aop:config&gt;元素下：对所有切面都有效</li>
<li>基于XML的AOP配置不允许在切入点表达式中用名称引用其他切入点。</li>
</ul>
<p><img src="/img%5C%E5%A3%B0%E6%98%8E%E5%88%87%E5%85%A5.png" alt="声明切入"></p>
<h4 id="3-声明通知"><a href="#3-声明通知" class="headerlink" title="3)    声明通知"></a>3)    声明通知</h4><ul>
<li>l  在aop名称空间中，每种通知类型都对应一个特定的XML元素。</li>
<li>l  通知元素需要使用<pointcut-ref>来引用切入点，或用<pointcut>直接嵌入切入点表达式。</li>
<li>l  method属性指定切面类中通知方法的名称</li>
</ul>
<p><img src="/img%5C%E5%A3%B0%E6%98%8E%E9%80%9A%E7%9F%A5.png" alt="声明通知"></p>
<h4 id="4-配置文件中的完整内容"><a href="#4-配置文件中的完整内容" class="headerlink" title="4)    配置文件中的完整内容"></a>4)    配置文件中的完整内容</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">&lt;!--配置计算器实现类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;calculator&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.spring.aop.xml.CalculatorImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置切面类--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;loggingAspect&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.spring.aop.xml.LoggingAspect&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--AOP配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切入点表达式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pointCut&quot;</span></span></span><br><span class="line"><span class="tag">                      <span class="attr">expression</span>=<span class="string">&quot;execution(* com.atguigu.spring.aop.xml.Calculator.*(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置切面--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;loggingAspect&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--前置通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:before</span> <span class="attr">method</span>=<span class="string">&quot;beforeAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:before</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--返回通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-returning</span> <span class="attr">method</span>=<span class="string">&quot;returningAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCut&quot;</span> <span class="attr">returning</span>=<span class="string">&quot;result&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-returning</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--异常通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after-throwing</span> <span class="attr">method</span>=<span class="string">&quot;throwingAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCut&quot;</span> <span class="attr">throwing</span>=<span class="string">&quot;e&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after-throwing</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--后置通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">&quot;afterAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:after</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--环绕通知--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;aroundAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCut&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:around</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="第5章-JdbcTemplate"><a href="#第5章-JdbcTemplate" class="headerlink" title="第5章 JdbcTemplate"></a>第5章 JdbcTemplate</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述:"></a>概述:</h2><p>​      为了使JDBC更加易于使用，Spring在JDBC API上定义了一个抽象层，以此建立一个JDBC存取框架。</p>
<p>​      作为Spring JDBC框架的核心，JDBC模板的设计目的是为不同类型的JDBC操作提供模板方法，通过这种方式，可以在尽可能保留灵活性的情况下，将数据库存取的工作量降到最低。 </p>
<p>​      可以将Spring的JdbcTemplate看作是一个小型的轻量级持久化层框架，和我们之前使用过的DBUtils风格非常接近。</p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建:"></a>环境搭建:</h2><h3 id="导入jar包"><a href="#导入jar包" class="headerlink" title="导入jar包"></a>导入jar包</h3><h4 id="1-Spring的核心包"><a href="#1-Spring的核心包" class="headerlink" title="1)     Spring的核心包"></a>1)     Spring的核心包</h4><p>spring-beans-5.3.1.jar</p>
<p>spring-context-5.3.1.jar</p>
<p>spring-core-5.3.1.jar</p>
<p>spring-expression-5.3.1.jar</p>
<p>spring-jcl-5.3.1.jar</p>
<p>spring-aop-5.3.1.jar</p>
<h4 id="2-JdbcTemplate需要的jar包"><a href="#2-JdbcTemplate需要的jar包" class="headerlink" title="2)     JdbcTemplate需要的jar包"></a>2)     JdbcTemplate需要的jar包</h4><p>spring-jdbc-5.3.1.jar</p>
<p>spring-orm-5.3.1.jar</p>
<p>spring-tx-5.3.1.jar</p>
<h4 id="3-连接数据库的驱动jar包和数据源"><a href="#3-连接数据库的驱动jar包和数据源" class="headerlink" title="3)     连接数据库的驱动jar包和数据源"></a>3)     连接数据库的驱动jar包和数据源</h4><p>mysql-connector-java-5.1.37-bin.jar</p>
<p>druid-1.1.9.jar</p>
<h4 id="4-单元测试的jar包"><a href="#4-单元测试的jar包" class="headerlink" title="4)     单元测试的jar包"></a>4)     单元测试的jar包</h4><p>junit-4.12.jar</p>
<p>hamcrest-core-1.3.jar</p>
<h3 id="创建数据库和表"><a href="#创建数据库和表" class="headerlink" title="创建数据库和表:"></a>创建数据库和表:</h3><p>​     在MySQL中执行资料中的jdbc_template.sql文件生成对应的数据库和表。</p>
<h4 id="创建druid-properties文件"><a href="#创建druid-properties文件" class="headerlink" title="创建druid.properties文件"></a>创建druid.properties文件</h4><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#key=value</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jdbc.username</span>=<span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/jdbc_template</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jdbc.driverClassName</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jdbc.initialSize</span>=<span class="string">5</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jdbc.maxActive</span>=<span class="string">10</span></span><br></pre></td></tr></table></figure>

<h4 id="创建Spring的配置文件"><a href="#创建Spring的配置文件" class="headerlink" title="创建Spring的配置文件:"></a>创建Spring的配置文件:</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--引入外部属性文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:druid.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置数据源--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.initialSize&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxActive&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--配置JdbcTemplate--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置数据源属性--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="操作数据库"><a href="#操作数据库" class="headerlink" title="操作数据库"></a>操作数据库</h4><h4 id="1-增删改"><a href="#1-增删改" class="headerlink" title="1)     增删改"></a>1)     增删改</h4><h5 id="n-JdbcTemplate-update-String-Object…"><a href="#n-JdbcTemplate-update-String-Object…" class="headerlink" title="n  JdbcTemplate.update(String, Object…)"></a>n  JdbcTemplate.update(String, Object…)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 增删改 通用操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into employee value(?,?,?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">   jdbcTemplate.update(sql,<span class="string">&quot;1003&quot;</span>,<span class="string">&quot;高虎&quot;</span>,<span class="string">&quot;haohu@163.com&quot;</span>,<span class="number">9000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-批量增删改"><a href="#2-批量增删改" class="headerlink" title="2)     批量增删改"></a>2)     批量增删改</h4><h5 id="n-JdbcTemplate-batchUpdate-String-List-lt-Object-gt"><a href="#n-JdbcTemplate-batchUpdate-String-List-lt-Object-gt" class="headerlink" title="n  JdbcTemplate.batchUpdate(String, List&lt;Object[]&gt;)"></a>n  JdbcTemplate.batchUpdate(String, List&lt;Object[]&gt;)</h5><ul>
<li>u  Object[]封装了SQL语句每一次执行时所需要的参数</li>
<li>u  List集合封装了SQL语句多次执行时的所有参数</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 批量的增删改操作</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBatch</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into employee value(?,?,?,?)&quot;</span>;</span><br><span class="line">    List&lt;Object[]&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    list.add(<span class="number">0</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;1004&quot;</span>,<span class="string">&quot;雷军&quot;</span>,<span class="string">&quot;leiju@mi.com&quot;</span>,<span class="number">10000</span>&#125;);</span><br><span class="line">    list.add(<span class="number">1</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;1005&quot;</span>,<span class="string">&quot;王力宏&quot;</span>,<span class="string">&quot;wanglihong@li.com&quot;</span>,<span class="number">10000</span>&#125;);</span><br><span class="line">    list.add(<span class="number">2</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;1006&quot;</span>,<span class="string">&quot;王哥&quot;</span>,<span class="string">&quot;wang@w.com&quot;</span>,<span class="number">10000</span>&#125;);</span><br><span class="line">    list.add(<span class="number">3</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;1007&quot;</span>,<span class="string">&quot;裴海洋&quot;</span>,<span class="string">&quot;peihaiyang@lover.com&quot;</span>,<span class="number">10000</span>&#125;);</span><br><span class="line">    list.add(<span class="number">4</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;1008&quot;</span>,<span class="string">&quot;小倩&quot;</span>,<span class="string">&quot;xiaoqian@qq.com&quot;</span>,<span class="number">10000</span>&#125;);</span><br><span class="line">    list.add(<span class="number">5</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;1009&quot;</span>,<span class="string">&quot;王强东&quot;</span>,<span class="string">&quot;wangqiangdong@jd.com&quot;</span>,<span class="number">10000</span>&#125;);</span><br><span class="line">    jdbcTemplate.batchUpdate(sql,list);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-查询单一值"><a href="#3-查询单一值" class="headerlink" title="3)    查询单一值"></a>3)    查询单一值</h4><h5 id="n-JdbcTemplate-queryForObject-String-Class-Object…"><a href="#n-JdbcTemplate-queryForObject-String-Class-Object…" class="headerlink" title="n  JdbcTemplate.queryForObject(String, Class, Object…)"></a>n  JdbcTemplate.queryForObject(String, Class, Object…)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 操作单个值的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryForObject</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select count(1) from employee&quot;</span>;</span><br><span class="line">    <span class="type">Long</span> <span class="variable">aLong</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, <span class="type">long</span>.class);</span><br><span class="line">    System.out.println(aLong);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-查询单个对象"><a href="#4-查询单个对象" class="headerlink" title="4)查询单个对象"></a>4)查询单个对象</h4><h5 id="n-JdbcTemplate-queryForObject-String-RowMapper-lt-T-gt-Object…"><a href="#n-JdbcTemplate-queryForObject-String-RowMapper-lt-T-gt-Object…" class="headerlink" title="n  JdbcTemplate.queryForObject(String, RowMapper&lt;T&gt;, Object…)"></a>n  JdbcTemplate.queryForObject(String, RowMapper&lt;T&gt;, Object…)</h5><p><img src="/img%5C%E8%8E%B7%E5%8F%96%E5%8D%95%E4%B8%AA%E5%AF%B9%E8%B1%A1.png" alt="获取单个对象"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取一个对象的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryForBean</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from employee where id = ?&quot;</span>;</span><br><span class="line">    RowMapper&lt;Employee&gt; mapper = <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Employee.class);</span><br><span class="line">    <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, mapper, <span class="string">&quot;1003&quot;</span>);</span><br><span class="line">    System.out.println(employee);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-查询多行"><a href="#5-查询多行" class="headerlink" title="5 )     查询多行"></a>5 )     查询多行</h4><h5 id="n-JdbcTemplate-query-String-RowMapper-lt-T-gt-Object…"><a href="#n-JdbcTemplate-query-String-RowMapper-lt-T-gt-Object…" class="headerlink" title="n  JdbcTemplate.query(String, RowMapper&lt;T&gt;, Object…)"></a>n  JdbcTemplate.query(String, RowMapper&lt;T&gt;, Object…)</h5><ul>
<li>n  RowMapper对象依然使用BeanPropertyRowMapper</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取集合的方法</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">query</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from employee&quot;</span>;</span><br><span class="line">    RowMapper&lt;Employee&gt; mapper = <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Employee.class);</span><br><span class="line">    List&lt;Employee&gt; query = jdbcTemplate.query(sql, mapper);</span><br><span class="line">    <span class="keyword">for</span> (Employee employee : query) &#123;</span><br><span class="line">        System.out.println(employee);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="通过注入JdbcTemplate实现Dao"><a href="#通过注入JdbcTemplate实现Dao" class="headerlink" title="通过注入JdbcTemplate实现Dao"></a>通过注入JdbcTemplate实现Dao</h3><p>​         JdbcTemplate类是线程安全的，所以可以在IOC容器中声明它的单个实例，并将这个实例注入到所有的Dao实例中。</p>
<h4 id="1-在Spring的配置文件中添加配置自动扫描的包"><a href="#1-在Spring的配置文件中添加配置自动扫描的包" class="headerlink" title="1)    在Spring的配置文件中添加配置自动扫描的包"></a>1)    在Spring的配置文件中添加配置自动扫描的包</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu.aop.aspect&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:druid.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line"></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxActive&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.initialSize&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-创建EmployeeDao及实现类并注入JdbcTemplate"><a href="#2-创建EmployeeDao及实现类并注入JdbcTemplate" class="headerlink" title="2)    创建EmployeeDao及实现类并注入JdbcTemplate"></a>2)    创建EmployeeDao及实现类并注入JdbcTemplate</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.aop.aspect.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.aop.aspect.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.aop.aspect.dao.EmployeeDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.RowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-26$-1:01</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository(&quot;employeeDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmployeeDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">EmployeeDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">   <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveEmployee</span><span class="params">(Employee employee)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into employee values(?,?,?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">        jdbcTemplate.update(sql,employee.getId(),employee.getLastName(),employee.getEmail(),employee.getSalary());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteById</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;delete from employee where id = ?&quot;</span>;</span><br><span class="line"></span><br><span class="line">        jdbcTemplate.update(sql,id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Employee employee)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update employee set last_name = ?,email = ?,salary = ? where id = ?&quot;</span>;</span><br><span class="line"></span><br><span class="line">        jdbcTemplate.update(sql,employee.getLastName(),employee.getEmail(),employee.getSalary(),employee.getId());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Employee <span class="title function_">getBean</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from employee where id = ?&quot;</span>;</span><br><span class="line">        RowMapper&lt;Employee&gt; mapper = <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Employee.class);</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, mapper, id);</span><br><span class="line">        <span class="keyword">return</span> employee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Employee&gt; <span class="title function_">getBeanList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from employee&quot;</span>;</span><br><span class="line">        RowMapper&lt;Employee&gt; mapper = <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Employee.class);</span><br><span class="line">        List&lt;Employee&gt; query = jdbcTemplate.query(sql, mapper);</span><br><span class="line">        <span class="keyword">return</span> query;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-测试"><a href="#3-测试" class="headerlink" title="3)测试"></a>3)测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line">第<span class="number">6</span>章 声明式事务<span class="keyword">package</span> com.atguigu.aop.aspect.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.druid.wall.violation.IllegalSQLObjectViolation;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.aop.aspect.bean.Employee;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.BeanPropertyRowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.RowMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.SingleColumnRowMapper;</span><br><span class="line"><span class="keyword">import</span> sun.awt.datatransfer.DataTransferer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-25$-15:26</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestdateSource</span> &#123;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;jdbc_template.xml&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="type">JdbcTemplate</span> <span class="variable">jdbcTemplate</span> <span class="operator">=</span> (JdbcTemplate) ioc.getBean(<span class="string">&quot;jdbcTemplate&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test02</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">DataSource</span> <span class="variable">bean</span> <span class="operator">=</span> ioc.getBean(DataSource.class);</span><br><span class="line"></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> bean.getConnection();</span><br><span class="line"></span><br><span class="line">        System.out.println(connection);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 增删改 通用操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into employee value(?,?,?,?)&quot;</span>;</span><br><span class="line"></span><br><span class="line">       jdbcTemplate.update(sql,<span class="string">&quot;1003&quot;</span>,<span class="string">&quot;高虎&quot;</span>,<span class="string">&quot;haohu@163.com&quot;</span>,<span class="number">9000</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 批量的增删改操作</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBatch</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;insert into employee value(?,?,?,?)&quot;</span>;</span><br><span class="line">        List&lt;Object[]&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">0</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;1004&quot;</span>,<span class="string">&quot;雷军&quot;</span>,<span class="string">&quot;leiju@mi.com&quot;</span>,<span class="number">10000</span>&#125;);</span><br><span class="line">        list.add(<span class="number">1</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;1005&quot;</span>,<span class="string">&quot;王力宏&quot;</span>,<span class="string">&quot;wanglihong@li.com&quot;</span>,<span class="number">10000</span>&#125;);</span><br><span class="line">        list.add(<span class="number">2</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;1006&quot;</span>,<span class="string">&quot;王哥&quot;</span>,<span class="string">&quot;wang@w.com&quot;</span>,<span class="number">10000</span>&#125;);</span><br><span class="line">        list.add(<span class="number">3</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;1007&quot;</span>,<span class="string">&quot;裴海洋&quot;</span>,<span class="string">&quot;peihaiyang@lover.com&quot;</span>,<span class="number">10000</span>&#125;);</span><br><span class="line">        list.add(<span class="number">4</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;1008&quot;</span>,<span class="string">&quot;小倩&quot;</span>,<span class="string">&quot;xiaoqian@qq.com&quot;</span>,<span class="number">10000</span>&#125;);</span><br><span class="line">        list.add(<span class="number">5</span>,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;1009&quot;</span>,<span class="string">&quot;王强东&quot;</span>,<span class="string">&quot;wangqiangdong@jd.com&quot;</span>,<span class="number">10000</span>&#125;);</span><br><span class="line">        jdbcTemplate.batchUpdate(sql,list);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 操作单个值的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryForObject</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select count(1) from employee&quot;</span>;</span><br><span class="line">        <span class="type">Long</span> <span class="variable">aLong</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, <span class="type">long</span>.class);</span><br><span class="line">        System.out.println(aLong);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取一个对象的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">queryForBean</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from employee where id = ?&quot;</span>;</span><br><span class="line">        RowMapper&lt;Employee&gt; mapper = <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Employee.class);</span><br><span class="line">        <span class="type">Employee</span> <span class="variable">employee</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql, mapper, <span class="string">&quot;1003&quot;</span>);</span><br><span class="line">        System.out.println(employee);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取集合的方法</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">query</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from employee&quot;</span>;</span><br><span class="line">        RowMapper&lt;Employee&gt; mapper = <span class="keyword">new</span> <span class="title class_">BeanPropertyRowMapper</span>&lt;&gt;(Employee.class);</span><br><span class="line">        List&lt;Employee&gt; query = jdbcTemplate.query(sql, mapper);</span><br><span class="line">        <span class="keyword">for</span> (Employee employee : query) &#123;</span><br><span class="line">            System.out.println(employee);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第6章-声明式事务"><a href="#第6章-声明式事务" class="headerlink" title="第6章 声明式事务"></a>第6章 声明式事务</h2><h3 id="事务概述"><a href="#事务概述" class="headerlink" title="事务概述"></a>事务概述</h3><p>在JavaEE企业级开发的应用领域，为了保证数据的完整性和一致性，必须引入数据库事务的概念，所以事务管理是企业级应用程序开发中必不可少的技术。</p>
<p>事务就是一组由于逻辑上紧密关联而合并成一个整体(工作单元)的多个数据库操作，这些操作要么都执行，要么都不执行。</p>
<h4 id="事务的四个特性-ACID"><a href="#事务的四个特性-ACID" class="headerlink" title="事务的四个特性(ACID)"></a>事务的四个特性(ACID)</h4><p>**1)     原子性(atomicity)**：“原子”的本意是“不可再分”，事务的原子性表现为一个事务中涉及到的多个操作在逻辑上缺一不可。事务的原子性要求事务中的所有操作要么都执行，要么都不执行。</p>
<p><strong>2)     一致性(consistency)：</strong>“一致”指的是数据的一致，具体是指：所有数据都处于满足业务规则的一致性状态。一致性原则要求：一个事务中不管涉及到多少个操作，都必须保证事务执行之前数据是正确的，事务执行之后数据仍然是正确的。如果一个事务在执行的过程中，其中某一个或某几个操作失败了，则必须将其他所有操作撤销，将数据恢复到事务执行之前的状态，这就是回滚。</p>
<p><strong>3)     隔离性(isolation)：</strong>在应用程序实际运行过程中，事务往往是并发执行的，所以很有可能有许多事务同时处理相同的数据，因此每个事务都应该与其他事务隔离开来，防止数据损坏。隔离性原则要求多个事务在并发执行过程中不会互相干扰。</p>
<p><strong>4)     持久性(durability)：</strong>持久性原则要求事务执行完成后，对数据的修改永久的保存下来，不会因各种系统错误或其他意外情况而受到影响。通常情况下，事务对数据的修改应该被写入到持久化存储器中。</p>
<h3 id="Spring的事务管理"><a href="#Spring的事务管理" class="headerlink" title="Spring的事务管理"></a>Spring的事务管理</h3><h4 id="编程式事务管理"><a href="#编程式事务管理" class="headerlink" title="编程式事务管理"></a>编程式事务管理</h4><h5 id="l-使用原生的JDBC-API进行事务管理的步骤："><a href="#l-使用原生的JDBC-API进行事务管理的步骤：" class="headerlink" title="l  使用原生的JDBC API进行事务管理的步骤："></a>l  使用原生的JDBC API进行事务管理的步骤：</h5><ol>
<li><pre><code>获取数据库连接Connection对象
</code></pre>
</li>
<li><pre><code>取消事务的自动提交
</code></pre>
</li>
<li><pre><code>执行操作
</code></pre>
</li>
<li><pre><code>正常完成操作时手动提交事务
</code></pre>
</li>
<li><pre><code>执行失败时回滚事务
</code></pre>
</li>
<li><pre><code>关闭相关资源
</code></pre>
</li>
</ol>
<h4 id="l-评价"><a href="#l-评价" class="headerlink" title="l  评价"></a>l  评价</h4><blockquote>
<p>​    使用原生的JDBC API实现事务管理是所有事务管理方式的基石，同时也是最典型的编程式事务管理。编程式事务管理需要将事务管理代码嵌入到业务方法中来控制事务的提交和回滚。在使用编程的方式管理事务时，必须在每个事务操作中包含额外的事务管理代码。相对于核心业务而言，事务管理的代码显然属于非核心业务，如果多个模块 都使用同样模式的代码进行事务管理，显然会造成较大程度的代码冗余。</p>
</blockquote>
<h3 id="声明式事务管理"><a href="#声明式事务管理" class="headerlink" title="声明式事务管理"></a>声明式事务管理</h3><p>Spring既支持编程式事务管理，也支持声明式的事务管理。</p>
<p>​    大多数情况下声明式事务比编程式事务管理更好：它将事务管理代码从业务方法中分离出来，以声明的方式来实现事务管理。</p>
<p>​      事务管理代码的固定模式作为一种横切关注点，可以通过AOP方法模块化，进而借助Spring AOP框架实现声明式事务管理。</p>
<p>​      Spring在不同的事务管理API之上定义了一个抽象层，通过配置的方式使其生效，从而让应用程序开发人员不必了解事务管理API的底层实现细节，就可以使用Spring的事务管理机制。</p>
<h3 id="Spring提供的事务管理器"><a href="#Spring提供的事务管理器" class="headerlink" title="Spring提供的事务管理器"></a>Spring提供的事务管理器</h3><p>Spring从不同的事务管理API中抽象出了一整套事务管理机制，让事务管理代码从特定的事务技术中独立出来。开发人员通过配置的方式进行事务管理，而不必了解其底层是如何实现的。</p>
<p>​      Spring的核心事务管理抽象是<strong>PlatformTransactionManager接口</strong>，它为事务管理封装了一组独立于技术的方法。无论使用Spring的哪种事务管理策略(编程式或声明式)，事务管理器都是必须的。</p>
<p>​      事务管理器可以以普通的bean的形式声明在Spring IOC容器中。</p>
<h4 id="事务管理器的主要实现类："><a href="#事务管理器的主要实现类：" class="headerlink" title="事务管理器的主要实现类："></a>事务管理器的主要实现类：</h4><p><img src="/img%5C%E4%BA%8B%E5%8A%A1%E7%AE%A1%E7%90%86%E9%A1%B6%E5%B1%82%E6%8E%A5%E5%8F%A3.png" alt="事务管理顶层接口"></p>
<ol>
<li><pre><code>DataSourceTransactionManager：在应用程序中只需要处理一个数据源，而且通过JDBC存取。
</code></pre>
</li>
<li><pre><code>HibernateTransactionManager：用Hibernate框架存取数据库
</code></pre>
</li>
</ol>
<h3 id="引入案例-1"><a href="#引入案例-1" class="headerlink" title="引入案例"></a>引入案例</h3><h4 id="创建数据库和表-1"><a href="#创建数据库和表-1" class="headerlink" title="创建数据库和表"></a>创建数据库和表</h4><p>​     在MySQL中执行资料中的spring_transaction.sql文件生成对应的数据库和表。</p>
<h4 id="需求：购买图书"><a href="#需求：购买图书" class="headerlink" title="需求：购买图书"></a>需求：购买图书</h4><h4 id="1-接口"><a href="#1-接口" class="headerlink" title="1)     接口"></a>1)     接口</h4><h5 id="l-BookShopDao"><a href="#l-BookShopDao" class="headerlink" title="l  BookShopDao"></a>l  BookShopDao</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookShopDao</span> &#123;</span><br><span class="line">    <span class="comment">//根据图书的书号获取图书的价格</span></span><br><span class="line">    Double <span class="title function_">getBookPrice</span><span class="params">(String isbn)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据图书的书号更新图书的库存，一次买一本图书</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateBookStock</span><span class="params">(String isbn)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据用户的id和图书的价格更新用户的账户余额</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">updateUserBalance</span><span class="params">(<span class="type">int</span> userId , Double bookPrice)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2）BookShopService"><a href="#2）BookShopService" class="headerlink" title="2）BookShopService"></a>2）BookShopService</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookShopService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//购买图书</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">purchase</span><span class="params">(<span class="type">int</span> userId , String isbn)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="2-创建Spring的配置文件配置数据源和JdbcTemplate"><a href="#2-创建Spring的配置文件配置数据源和JdbcTemplate" class="headerlink" title="2)    创建Spring的配置文件配置数据源和JdbcTemplate"></a>2)    创建Spring的配置文件配置数据源和JdbcTemplate</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--自动扫描包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu.transaction&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引入外部的资源文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:druid.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--      配置数据源--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.initialSize&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxActive&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 配置jdbcTemplate   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注册事务的注解驱动    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-创建实现类"><a href="#3-创建实现类" class="headerlink" title="3)    创建实现类"></a>3)    创建实现类</h4><h5 id="BookShopDaoImpl"><a href="#BookShopDaoImpl" class="headerlink" title="BookShopDaoImpl"></a>BookShopDaoImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.transaction.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.transaction.dao.BookShopDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-26$-9:49</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Repository(&quot;bookShopDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookShopDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookShopDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getBookPrice</span><span class="params">(String isbn)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select price from book where isbn = ?&quot;</span>;</span><br><span class="line">        <span class="type">Double</span> <span class="variable">aDouble</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql,Double.class,isbn);</span><br><span class="line">        <span class="keyword">return</span> aDouble;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBookStock</span><span class="params">(String isbn)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update book set stock = stock - 1 where isbn = ?&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql,isbn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUserBalance</span><span class="params">(<span class="type">int</span> userId, Double bookPrice)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update account set balance = balance- ? where id = ?&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql,bookPrice,userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="BookShopServiceImpl"><a href="#BookShopServiceImpl" class="headerlink" title="BookShopServiceImpl"></a>BookShopServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.transaction.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.transaction.dao.BookShopDao;</span><br><span class="line"><span class="keyword">import</span> com.atguigu.transaction.service.BookShopService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Isolation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Propagation;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-26$-9:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Service(&quot;bookShopService&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookShopServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookShopService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> BookShopDao bookShopDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW,isolation = Isolation.READ_COMMITTED)</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">purchase</span><span class="params">(<span class="type">int</span> userId, String isbn)</span> &#123;</span><br><span class="line">        bookShopDao.updateBookStock(isbn);</span><br><span class="line">        <span class="type">Double</span> <span class="variable">bookPrice</span> <span class="operator">=</span> bookShopDao.getBookPrice(isbn);</span><br><span class="line">        bookShopDao.updateUserBalance(userId,bookPrice);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4-测试"><a href="#4-测试" class="headerlink" title="4)    测试"></a>4)    测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.transaction.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.transaction.xml.BookShopService;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-26$-15:54</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tx_XmlText</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans-tx-xml.xml&quot;</span>);</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">BookShopService</span> <span class="variable">bean</span> <span class="operator">=</span> (BookShopService) ioc.getBean(<span class="string">&quot;bookShopService2&quot;</span>);</span><br><span class="line">        bean.purchase(<span class="number">1</span>,<span class="string">&quot;1001&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li><pre><code>出现的问题
</code></pre>
</li>
</ol>
<p>当用户账户余额不足时会抛出异常，但是图书的库存却会减去一本！</p>
<ol start="2">
<li><pre><code>解决方案
</code></pre>
</li>
</ol>
<p>添加事务</p>
<h3 id="基于注解方式的声明式事务"><a href="#基于注解方式的声明式事务" class="headerlink" title="基于注解方式的声明式事务"></a>基于注解方式的声明式事务</h3><h4 id="购买图书案例中添加Spring的声明式事务"><a href="#购买图书案例中添加Spring的声明式事务" class="headerlink" title="购买图书案例中添加Spring的声明式事务"></a>购买图书案例中添加Spring的声明式事务</h4><h4 id="1-导入AOP相关的jar包"><a href="#1-导入AOP相关的jar包" class="headerlink" title="1)     导入AOP相关的jar包"></a>1)     导入AOP相关的jar包</h4><p>spring-aspects-5.3.1.jar</p>
<p>com.springsource.org.aspectj.weaver-1.6.8.RELEASE.jar</p>
<h4 id="2-在Spring的配置文件中添加以下配置"><a href="#2-在Spring的配置文件中添加以下配置" class="headerlink" title="2)    在Spring的配置文件中添加以下配置"></a>2)    在Spring的配置文件中添加以下配置</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--自动扫描包--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.atguigu.transaction&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--引入外部的资源文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:druid.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--      配置数据源--&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.initialSize&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxActive&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!-- 配置jdbcTemplate   --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--配置事务管理--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--注册事务的注解驱动    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">tx:annotation-driven</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="3-在需要添加事务的方法上添加-Transactional注解"><a href="#3-在需要添加事务的方法上添加-Transactional注解" class="headerlink" title="3)    在需要添加事务的方法上添加@Transactional注解"></a>3)    在需要添加事务的方法上添加@Transactional注解</h5><p><img src="/img%5C%E6%B3%A8%E8%A7%A3%E4%BA%8B%E5%8A%A1.png" alt="注解事务"></p>
<h4 id="事务的传播行为"><a href="#事务的传播行为" class="headerlink" title="事务的传播行为"></a>事务的传播行为</h4><h4 id="1-简介-1"><a href="#1-简介-1" class="headerlink" title="1)     简介"></a>1)     简介</h4><p>当事务方法被另一个事务方法调用时，必须指定事务应该如何传播。例如：方法可能继续在现有事务中运行，也可能开启一个新事务，并在自己的事务中运行。</p>
<p>事务传播属性可以在@Transactional注解的propagation属性中定义。</p>
<h4 id="2-Spring的7种传播行为"><a href="#2-Spring的7种传播行为" class="headerlink" title="2)     Spring的7种传播行为"></a>2)     Spring的7种传播行为</h4><table>
<thead>
<tr>
<th>传播属性</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>REQUIRED</td>
<td>如果有事务在运行，当前的方法就在这个事务内运行；否则就启动一个新的事务，并在自己的事务内运行。</td>
</tr>
<tr>
<td>REQUIRES_NEW</td>
<td>当前的方法必须启动新事务，并在自己的事务内运行；如果有事务正在运行，应该将它挂起。</td>
</tr>
<tr>
<td>SUPPORTS</td>
<td>如果有事务在运行，当前的方法就在这个事务内运行，否则可以不运行在事务中。</td>
</tr>
<tr>
<td>NOT_SUPPORTED</td>
<td>当前的方法不应该运行在事务中，如果有运行的事务将它挂起</td>
</tr>
<tr>
<td>MANDATORY</td>
<td>当前的方法必须运行在事务中，如果没有正在运行的事务就抛出异常。</td>
</tr>
<tr>
<td>NEVER</td>
<td>当前的方法不应该运行在事务中，如果有正在运行的事务就抛出异常。</td>
</tr>
<tr>
<td>NESTED</td>
<td>如果有事务正在运行，当前的方法就应该在这个事务的嵌套事务内运行，否则就启动一个新的事务，并在它自己的事务内运行。</td>
</tr>
</tbody></table>
<h3 id="事务的隔离级别"><a href="#事务的隔离级别" class="headerlink" title="事务的隔离级别"></a>事务的隔离级别</h3><h4 id="1-数据库事务并发问题"><a href="#1-数据库事务并发问题" class="headerlink" title="1)     数据库事务并发问题"></a>1)     数据库事务并发问题</h4><h5 id="a-脏读"><a href="#a-脏读" class="headerlink" title="a)     脏读"></a>a)     脏读</h5><p>①Transaction01将某条记录的AGE值从20修改为30。</p>
<p>​      ②Transaction02读取了Transaction01更新后的值：30。</p>
<p>​      ③Transaction01回滚，AGE值恢复到了20。</p>
<p>​      ④Transaction02读取到的30就是一个无效的值。</p>
<p>​      简单来说就是你读到了别人更新但未提交的数据。</p>
<h5 id="b-不可重复度"><a href="#b-不可重复度" class="headerlink" title="b)     不可重复度"></a>b)     不可重复度</h5><p>①Transaction01读取了AGE值为20。</p>
<p>​      ②Transaction02将AGE值修改为30并提交。</p>
<p>​      ③Transaction01再次读取AGE值为30，和第一次读取不一致。</p>
<p>简单来说就是你两次读取的值不可能重复。</p>
<h5 id="c-幻读"><a href="#c-幻读" class="headerlink" title="c)     幻读"></a>c)     幻读</h5><p>①Transaction01读取了STUDENT表中的一部分数据。</p>
<p>​      ②Transaction02向STUDENT表中插入了新的行。</p>
<p>​      ③Transaction01读取了STUDENT表时，多出了一些行。</p>
<p>简单来说就是你两次读取的表中的记录不一样，好像出现幻觉似的。</p>
<h4 id="2-隔离级别"><a href="#2-隔离级别" class="headerlink" title="2)     隔离级别"></a>2)     隔离级别</h4><p>数据库系统必须具有隔离并发运行各个事务的能力，使它们不会相互影响，避免各种并发问题。一个事务与其他事务隔离的程度称为隔离级别。SQL标准中规定了多种事务隔离级别，不同隔离级别对应不同的干扰程度，隔离级别越高，数据一致性就越好，但并发性越弱。</p>
<p>隔离级别一共有四种：</p>
<h5 id="①-读未提交：READ-UNCOMMITTED"><a href="#①-读未提交：READ-UNCOMMITTED" class="headerlink" title="①   读未提交：READ UNCOMMITTED"></a>①   读未提交：READ UNCOMMITTED</h5><p>允许Transaction01读取Transaction02未提交的修改。</p>
<h5 id="②-读已提交：READ-COMMITTED、"><a href="#②-读已提交：READ-COMMITTED、" class="headerlink" title="②   读已提交：READ COMMITTED、"></a>②   读已提交：READ COMMITTED、</h5><p>要求Transaction01只能读取Transaction02已提交的修改。</p>
<h5 id="③-可重复读：REPEATABLE-READ"><a href="#③-可重复读：REPEATABLE-READ" class="headerlink" title="③   可重复读：REPEATABLE READ"></a>③   可重复读：REPEATABLE READ</h5><p>确保Transaction01可以多次从一个字段中读取到相同的值，即Transaction01执行期间禁止其它事务对这个字段进行更新。</p>
<h5 id="④-串行化：SERIALIZABLE"><a href="#④-串行化：SERIALIZABLE" class="headerlink" title="④   串行化：SERIALIZABLE"></a>④   串行化：SERIALIZABLE</h5><p>确保Transaction01可以多次从一个表中读取到相同的行，在Transaction01执行期间，禁止其它事务对这个表进行添加、更新、删除操作。可以避免任何并发问题，但性能十分低下。</p>
<h5 id="⑤-各个隔离级别解决并发问题的能力见下表"><a href="#⑤-各个隔离级别解决并发问题的能力见下表" class="headerlink" title="⑤   各个隔离级别解决并发问题的能力见下表"></a>⑤   各个隔离级别解决并发问题的能力见下表</h5><table>
<thead>
<tr>
<th></th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻读</th>
</tr>
</thead>
<tbody><tr>
<td>READ UNCOMMITTED</td>
<td>有</td>
<td>有</td>
<td>有</td>
</tr>
<tr>
<td>READ COMMITTED</td>
<td>无</td>
<td>有</td>
<td>有</td>
</tr>
<tr>
<td>REPEATABLE READ</td>
<td>无</td>
<td>无</td>
<td>有</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>无</td>
<td>无</td>
<td>无</td>
</tr>
</tbody></table>
<h4 id="①-各种数据库产品对事务隔离级别的支持程度"><a href="#①-各种数据库产品对事务隔离级别的支持程度" class="headerlink" title="①  各种数据库产品对事务隔离级别的支持程度"></a>①  各种数据库产品对事务隔离级别的支持程度</h4><table>
<thead>
<tr>
<th></th>
<th>Oracle</th>
<th>MySQL</th>
</tr>
</thead>
<tbody><tr>
<td>READ   UNCOMMITTED</td>
<td>×</td>
<td>√</td>
</tr>
<tr>
<td>READ   COMMITTED</td>
<td>√(默认)</td>
<td>√</td>
</tr>
<tr>
<td>REPEATABLE   READ</td>
<td>×</td>
<td>√(默认)</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>√</td>
<td>√</td>
</tr>
</tbody></table>
<h4 id="3-在Spring中指定事务隔离级别"><a href="#3-在Spring中指定事务隔离级别" class="headerlink" title="3)     在Spring中指定事务隔离级别"></a>3)     在Spring中指定事务隔离级别</h4><p>在@Transactional的isolation属性中设置隔离级别</p>
<h4 id="Transactional注解中的其他属性"><a href="#Transactional注解中的其他属性" class="headerlink" title="@Transactional注解中的其他属性"></a>@Transactional注解中的其他属性</h4><h5 id="1-触发事务回滚的异常"><a href="#1-触发事务回滚的异常" class="headerlink" title="1)     触发事务回滚的异常"></a>1)     触发事务回滚的异常</h5><h6 id="a-默认情况下，捕获到RuntimeException或Error时回滚，而捕获到编译时异常不回滚。"><a href="#a-默认情况下，捕获到RuntimeException或Error时回滚，而捕获到编译时异常不回滚。" class="headerlink" title="a)     默认情况下，捕获到RuntimeException或Error时回滚，而捕获到编译时异常不回滚。"></a>a)     默认情况下，捕获到RuntimeException或Error时回滚，而捕获到编译时异常不回滚。</h6><h6 id="b-Transactional注解中设置回滚的属性"><a href="#b-Transactional注解中设置回滚的属性" class="headerlink" title="b)     @Transactional注解中设置回滚的属性"></a>b)     @Transactional注解中设置回滚的属性</h6><p>​                i.         rollbackFor或rollbackForClassName属性：指定遇到时必须进行回滚的异常类型，可以为多个。</p>
<p>​               ii.         noRollbackFor或noRollbackForClassName属性：指定遇到时不回滚的异常类型，可以为多个。</p>
<p><img src="/img@transaction%E7%9A%84%E5%85%B6%E4%BB%96%E5%B1%9E%E6%80%A7.png" alt="@transaction的其他属性"></p>
<h4 id="1-事务的超时时间"><a href="#1-事务的超时时间" class="headerlink" title="1)     事务的超时时间"></a>1)     事务的超时时间</h4><p>由于事务可以在行和表上获得锁，因此长事务会占用资源，并对整体性能产生影响。</p>
<p>timeout超时事务属性可以设置事务在强制回滚之前可以保持多久。这样可以防止长期运行的事务占用资源。</p>
<h4 id="2-只读属性"><a href="#2-只读属性" class="headerlink" title="2)     只读属性"></a>2)     只读属性</h4><p>如果一个事务只读取数据但不做修改，数据库引擎可以对这个事务进行优化。</p>
<h5 id="readOnly"><a href="#readOnly" class="headerlink" title="readOnly"></a>readOnly</h5><p>如果一个事务只读取数据但不做修改，数据库引擎可以对这个事务进行优化。</p>
<p>readOnly只读事务属性可以设置这个事务只读取数据但不更新数据, 这样可以帮助数据库引擎优化事务。</p>
<p><img src="/img%5CQQ%E6%88%AA%E5%9B%BE20210127004229.png" alt="QQ截图20210127004229"></p>
<h3 id="基于XML方式的声明式事务"><a href="#基于XML方式的声明式事务" class="headerlink" title="基于XML方式的声明式事务"></a>基于XML方式的声明式事务</h3><h4 id="修改实现类"><a href="#修改实现类" class="headerlink" title="修改实现类"></a>修改实现类</h4><h5 id="l-BookShopDaoImpl"><a href="#l-BookShopDaoImpl" class="headerlink" title="l  BookShopDaoImpl"></a>l  BookShopDaoImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.transaction.xml;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-26$-9:49</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookShopDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookShopDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setJdbcTemplate</span><span class="params">(JdbcTemplate jdbcTemplate)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.jdbcTemplate = jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Double <span class="title function_">getBookPrice</span><span class="params">(String isbn)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select price from book where isbn = ?&quot;</span>;</span><br><span class="line">        <span class="type">Double</span> <span class="variable">aDouble</span> <span class="operator">=</span> jdbcTemplate.queryForObject(sql,Double.class,isbn);</span><br><span class="line">        <span class="keyword">return</span> aDouble;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBookStock</span><span class="params">(String isbn)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update book set stock = stock - 1 where isbn = ?&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql,isbn);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUserBalance</span><span class="params">(<span class="type">int</span> userId, Double bookPrice)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;update account set balance = balance- ? where id = ?&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql,bookPrice,userId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="l-BookShopServiceImpl"><a href="#l-BookShopServiceImpl" class="headerlink" title="l  BookShopServiceImpl"></a>l  BookShopServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.transaction.xml;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-26$-9:55</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookShopServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">BookShopService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> BookShopDao bookShopDao;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBookShopDao</span><span class="params">(BookShopDao bookShopDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bookShopDao = bookShopDao;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">purchase</span><span class="params">(<span class="type">int</span> userId, String isbn)</span> &#123;</span><br><span class="line">        bookShopDao.updateBookStock(isbn);</span><br><span class="line">        <span class="type">Double</span> <span class="variable">bookPrice</span> <span class="operator">=</span> bookShopDao.getBookPrice(isbn);</span><br><span class="line">        bookShopDao.updateUserBalance(userId,bookPrice);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="创建一个Spring的配置文件"><a href="#创建一个Spring的配置文件" class="headerlink" title="创建一个Spring的配置文件"></a>创建一个Spring的配置文件</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">       http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd http://www.springframework.org/schema/aop https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:druid.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">context:property-placeholder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;initialSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.initialSize&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.maxActive&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driverClassName&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--    jdbcTemplate--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.core.JdbcTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--事务管理器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--bookdao--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookShopDao2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.transaction.xml.BookShopDaoImpl&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcTemplate&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;jdbcTemplate&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">           <span class="comment">&lt;!--    bookservice--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.atguigu.transaction.xml.BookShopServiceImpl&quot;</span> <span class="attr">id</span>=<span class="string">&quot;bookShopService2&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bookShopDao&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;bookShopDao2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!--    配置spring的声明事务--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;tx_advice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;dataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">             <span class="comment">&lt;!--        配置要执行事务的方法--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--添加事务的方法--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;purchase&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRED&quot;</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--   读取方法添加事务 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;get*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRES_NEW&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;find*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRES_NEW&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--      给所有方法添加事务      --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span> <span class="attr">propagation</span>=<span class="string">&quot;REQUIRES_NEW&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;pointCut&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.atguigu.transaction.xml.BookShopService.purchase(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;pointCut&quot;</span> <span class="attr">advice-ref</span>=<span class="string">&quot;tx_advice&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:advisor</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.transaction.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.transaction.xml.BookShopService;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> PHY</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021-01-26$-15:54</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tx_XmlText</span> &#123;</span><br><span class="line">    <span class="type">ApplicationContext</span> <span class="variable">ioc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans-tx-xml.xml&quot;</span>);</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">BookShopService</span> <span class="variable">bean</span> <span class="operator">=</span> (BookShopService) ioc.getBean(<span class="string">&quot;bookShopService2&quot;</span>);</span><br><span class="line">        bean.purchase(<span class="number">1</span>,<span class="string">&quot;1001&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：由于是从基于注解的方式配置声明式事务哪儿复制的接口和类，导包时一定不要导错，否则会出现类型转换异常。</p>
</blockquote>
<h3 id="创建log4j2-xml配置文件"><a href="#创建log4j2-xml配置文件" class="headerlink" title="创建log4j2.xml配置文件"></a>创建log4j2.xml配置文件</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--日志级别以及优先级排序: OFF &gt; FATAL &gt; ERROR &gt; WARN &gt; INFO &gt; DEBUG &gt; TRACE &gt; ALL --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--Configuration后面的status用于设置log4j2自身内部的信息输出，可以不设置，当设置成trace时，可以看到log4j2内部各种详细输出--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">status</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--先定义所有的appender--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">appenders</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--输出日志信息到控制台--&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">console</span> <span class="attr">name</span>=<span class="string">&quot;Console&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!--控制日志输出的格式--&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">console</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appenders</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--然后定义logger，只有定义了logger并引入的appender，appender才会生效--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--root：用于指定项目的根日志，如果没有单独指定Logger，则会使用root作为默认的日志输出--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">loggers</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;Console&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">loggers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Spring 5其他的特性请参考老师的Spring</p>
 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          Donate
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>Copyright： </strong>
          
          Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=https://peihaiyang.github.io/2022/03/07/Spring/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2022/03/07/JavaSE%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-nav-link">
        <strong class="article-nav-caption">上一篇</strong>
        <div class="article-nav-title">
          
            (no title)
          
        </div>
      </a>
    
    
      <a href="/2022/03/06/hello-world/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">Hello World</div>
      </a>
    
  </nav>

  
   
    
    <script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script>
    <div id="twikoo" class="twikoo"></div>
    <script>
        twikoo.init({
            envId: ""
        })
    </script>
 
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2015-2022
        <i class="ri-heart-fill heart_icon"></i> PHY
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/ayer-side.svg" alt="红尘泪思颜"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags/%E6%97%85%E8%A1%8C/">旅行</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" target="_blank" rel="noopener" href="http://shenyu-vip.lofter.com">摄影</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/friends">友链</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/2019/about">关于我</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>请我喝杯咖啡吧~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>